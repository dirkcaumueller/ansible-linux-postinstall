<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>Example 2: Update passwords submitted in the variable</title>
    <link rel="stylesheet" href="_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="example-2-update-passwords-submitted-in-the-variable">
<h1>Example 2: Update passwords submitted in the variable</h1>
<p>Update passwords of users at host <em>test_01</em>. Use the same playbook and
variables as in Example 1. Update the variable <em>lp_users</em> with the new
passwords stored in the attribute <code class="docutils literal notranslate"><span class="pre">userpass</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="hll"> <span class="l l-Scalar l-Scalar-Plain">shell&gt; cat host_vars/test_01/lp-users.yml</span>
</span> <span class="l l-Scalar l-Scalar-Plain">lp_users</span><span class="p p-Indicator">:</span>
   <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span> <span class="nv">user1</span><span class="p p-Indicator">,</span><span class="nt"> shell</span><span class="p">:</span> <span class="nv">/bin/sh</span><span class="p p-Indicator">,</span><span class="nt"> userpass</span><span class="p">:</span> <span class="nv">user1_password</span><span class="p p-Indicator">}</span>
   <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nt">name</span><span class="p">:</span> <span class="nv">user2</span><span class="p p-Indicator">,</span><span class="nt"> shell</span><span class="p">:</span> <span class="nv">/bin/bash</span><span class="p p-Indicator">,</span><span class="nt"> userpass</span><span class="p">:</span> <span class="nv">user2_password</span><span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>Update the passwords</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="hll">shell&gt; ansible-playbook linux-postinstall.yml -t lp_passwords <span class="se">\</span>
</span>                                    -e <span class="s1">&#39;lp_passwordstore_overwrite=True&#39;</span>
...
TASK <span class="o">[</span>vbotka.linux_postinstall : users: Manage user accounts<span class="o">]</span> **********
changed: <span class="o">[</span>test_01<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">(</span><span class="nv">item</span><span class="o">=</span>user1<span class="o">)</span>
changed: <span class="o">[</span>test_01<span class="o">]</span> <span class="o">=</span>&gt; <span class="o">(</span><span class="nv">item</span><span class="o">=</span>user2<span class="o">)</span>
</pre></div>
</div>
<p>The command is idempotent</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="hll">shell&gt; ansible-playbook linux-postinstall.yml -t lp_passwords <span class="se">\</span>
</span>                                    -e <span class="s1">&#39;lp_passwordstore_overwrite=True&#39;</span>
...

PLAY RECAP *************************************************************
test_01: <span class="nv">ok</span><span class="o">=</span><span class="m">18</span> <span class="nv">changed</span><span class="o">=</span><span class="m">0</span> <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span> <span class="nv">failed</span><span class="o">=</span><span class="m">0</span> <span class="nv">skipped</span><span class="o">=</span><span class="m">20</span> <span class="nv">rescued</span><span class="o">=</span><span class="m">0</span> ...
</pre></div>
</div>
<p>Show the passwords stored in <em>passwordstore</em> at the controller</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="hll">shell&gt; pass test_01
</span>test_01
├── user1
└── user2

<span class="hll">shell&gt; pass test_01/user1
</span>user1_password
lookup_pass: First generated by ansible on <span class="m">01</span>/07/2020 <span class="m">16</span>:59:00

<span class="hll">shell&gt; pass test_01/user2
</span>user2_password
lookup_pass: First generated by ansible on <span class="m">01</span>/07/2020 <span class="m">16</span>:59:00
</pre></div>
</div>
<p>See the <em>passwordstore</em> log at the controller <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">log</span></code> and test the
new passwords at <em>test_01</em>.</p>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>