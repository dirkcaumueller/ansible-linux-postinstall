<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <title>Annotated source code</title>
    <link rel="stylesheet" href="_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <div class="section" id="annotated-source-code">
<span id="as"></span><h1><a class="toc-backref" href="#id59">Annotated source code</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#annotated-source-code" id="id59">Annotated source code</a></p>
<ul>
<li><p><a class="reference internal" href="#tasks" id="id60">Tasks</a></p>
<ul>
<li><p><a class="reference internal" href="#main-yml" id="id61">main.yml</a></p></li>
<li><p><a class="reference internal" href="#acpi-yml" id="id62">acpi.yml</a></p></li>
<li><p><a class="reference internal" href="#aliases-yml" id="id63">aliases.yml</a></p></li>
<li><p><a class="reference internal" href="#apparmor-yml" id="id64">apparmor.yml</a></p></li>
<li><p><a class="reference internal" href="#authorized-keys-yml" id="id65">authorized_keys.yml</a></p></li>
<li><p><a class="reference internal" href="#autofs-yml" id="id66">autofs.yml</a></p></li>
<li><p><a class="reference internal" href="#auto-upgrades-yml" id="id67">auto_upgrades.yml</a></p></li>
<li><p><a class="reference internal" href="#bluetooth-yml" id="id68">bluetooth.yml</a></p></li>
<li><p><a class="reference internal" href="#cron-yml" id="id69">cron.yml</a></p></li>
<li><p><a class="reference internal" href="#debsums-yml" id="id70">debsums.yml</a></p></li>
<li><p><a class="reference internal" href="#debug-yml" id="id71">debug.yml</a></p></li>
<li><p><a class="reference internal" href="#fstab-yml" id="id72">fstab.yml</a></p></li>
<li><p><a class="reference internal" href="#gpg-yml" id="id73">gpg.yml</a></p></li>
<li><p><a class="reference internal" href="#gpsd-yml" id="id74">gpsd.yml</a></p></li>
<li><p><a class="reference internal" href="#grub-yml" id="id75">grub.yml</a></p></li>
<li><p><a class="reference internal" href="#hostname-yml" id="id76">hostname.yml</a></p></li>
<li><p><a class="reference internal" href="#hosts-yml" id="id77">hosts.yml</a></p></li>
<li><p><a class="reference internal" href="#iptables-yml" id="id78">iptables.yml</a></p></li>
<li><p><a class="reference internal" href="#kvm-yml" id="id79">kvm.yml</a></p></li>
<li><p><a class="reference internal" href="#latex-yml" id="id80">latex.yml</a></p></li>
<li><p><a class="reference internal" href="#libvirt-conf-yml" id="id81">libvirt-conf.yml</a></p></li>
<li><p><a class="reference internal" href="#libvirt-yml" id="id82">libvirt.yml</a></p></li>
<li><p><a class="reference internal" href="#lid-yml" id="id83">lid.yml</a></p></li>
<li><p><a class="reference internal" href="#logrotate-yml" id="id84">logrotate.yml</a></p></li>
<li><p><a class="reference internal" href="#modemmanager-yml" id="id85">modemmanager.yml</a></p></li>
<li><p><a class="reference internal" href="#modules-yml" id="id86">modules.yml</a></p></li>
<li><p><a class="reference internal" href="#netplan-yml" id="id87">netplan.yml</a></p></li>
<li><p><a class="reference internal" href="#nfsd-yml" id="id88">nfsd.yml</a></p></li>
<li><p><a class="reference internal" href="#packages-auto-yml" id="id89">packages-auto.yml</a></p></li>
<li><p><a class="reference internal" href="#packages-yml" id="id90">packages.yml</a></p></li>
<li><p><a class="reference internal" href="#passwords-yml" id="id91">passwords.yml</a></p></li>
<li><p><a class="reference internal" href="#pm-utils-yml" id="id92">pm-utils.yml</a></p></li>
<li><p><a class="reference internal" href="#postfix-yml" id="id93">postfix.yml</a></p></li>
<li><p><a class="reference internal" href="#reboot-yml" id="id94">reboot.yml</a></p></li>
<li><p><a class="reference internal" href="#repos-yml" id="id95">repos.yml</a></p></li>
<li><p><a class="reference internal" href="#resolvconf-yml" id="id96">resolvconf.yml</a></p></li>
<li><p><a class="reference internal" href="#service-yml" id="id97">service.yml</a></p></li>
<li><p><a class="reference internal" href="#smart-yml" id="id98">smart.yml</a></p></li>
<li><p><a class="reference internal" href="#speechd-yml" id="id99">speechd.yml</a></p></li>
<li><p><a class="reference internal" href="#sshd-yml" id="id100">sshd.yml</a></p></li>
<li><p><a class="reference internal" href="#ssh-yml" id="id101">ssh.yml</a></p></li>
<li><p><a class="reference internal" href="#sudoers-yml" id="id102">sudoers.yml</a></p></li>
<li><p><a class="reference internal" href="#swap-yml" id="id103">swap.yml</a></p></li>
<li><p><a class="reference internal" href="#sysctl-yml" id="id104">sysctl.yml</a></p></li>
<li><p><a class="reference internal" href="#timesyncd-yml" id="id105">timesyncd.yml</a></p></li>
<li><p><a class="reference internal" href="#timezone-yml" id="id106">timezone.yml</a></p></li>
<li><p><a class="reference internal" href="#tlp-yml" id="id107">tlp.yml</a></p></li>
<li><p><a class="reference internal" href="#udev-yml" id="id108">udev.yml</a></p></li>
<li><p><a class="reference internal" href="#ufw-yml" id="id109">ufw.yml</a></p></li>
<li><p><a class="reference internal" href="#users-yml" id="id110">users.yml</a></p></li>
<li><p><a class="reference internal" href="#vars-yml" id="id111">vars.yml</a></p></li>
<li><p><a class="reference internal" href="#virtualbox-yml" id="id112">virtualbox.yml</a></p></li>
<li><p><a class="reference internal" href="#wpagui-yml" id="id113">wpagui.yml</a></p></li>
<li><p><a class="reference internal" href="#wpasupplicant-yml" id="id114">wpasupplicant.yml</a></p></li>
<li><p><a class="reference internal" href="#xen-yml" id="id115">xen.yml</a></p></li>
<li><p><a class="reference internal" href="#xorg-yml" id="id116">xorg.yml</a></p></li>
<li><p><a class="reference internal" href="#zeitgeist-yml" id="id117">zeitgeist.yml</a></p></li>
<li><p><a class="reference internal" href="#zfs-yml" id="id118">zfs.yml</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="tasks">
<span id="as-tree"></span><h2><a class="toc-backref" href="#id60">Tasks</a></h2>
<div class="section" id="main-yml">
<span id="as-main-yml"></span><h3><a class="toc-backref" href="#id61">main.yml</a></h3>
<p>Synopsis: Tasks of the playbook.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/main.yml">main.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/main.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># tasks linux-postinstall</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">vars.yml</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">lp_vars</span><span class="p p-Indicator">,</span> <span class="nv">always</span><span class="p p-Indicator">]</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">debug.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">lp_debug</span><span class="p p-Indicator">,</span> <span class="nv">always</span><span class="p p-Indicator">]</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">swap.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">((ansible_os_family == &quot;RedHat&quot;) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;)) and lp_swap|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_swap</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">modules.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;RedHat&quot;) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;)</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_modules</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">udev.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">((ansible_os_family == &quot;RedHat&quot;) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;)) and lp_udev|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_udev</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fstab.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">((ansible_os_family == &quot;RedHat&quot;) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;))</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_fstab</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">netplan.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_netplan|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_netplan</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">timezone.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">((ansible_os_family == &quot;RedHat&quot;) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;)) and lp_timezone|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_timezone</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">timesyncd.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_timesyncd|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_timesyncd</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">repos.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_repos</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">packages.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;RedHat&quot;) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;)</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">auto_upgrades.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_auto_upgrades|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_auto_upgrades</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sysctl.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;RedHat&quot;) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;)</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_sysctl</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zfs.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_zfs|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_zfs</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hostname.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;RedHat&quot;) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;)</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_hostname</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hosts.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;RedHat&quot;) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;)</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_hosts</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">iptables.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_iptables|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_iptables</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">grub.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_grub|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_grub</span>
  <span class="c1"># https://unix.stackexchange.com/questions/152222/</span>
  <span class="c1"># equivalent-of-update-grub-for-rhel-fedora-centos-systems</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">users.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;RedHat&quot; ) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot; )</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_users</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gpg.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_gpg|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpg</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">passwords.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;RedHat&quot; ) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot; ) and lp_passwords|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_passwords</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sudoers.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;RedHat&quot; ) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot; )</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_sudoers</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">authorized_keys.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;RedHat&quot; ) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot; )</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_authorized_keys</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aliases.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">((ansible_os_family == &quot;RedHat&quot; ) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot; )) and lp_aliases|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_aliases</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pm-utils.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_pm|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_pm</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ssh.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">((ansible_os_family == &quot;RedHat&quot; ) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot; )) and lp_ssh|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ssh</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sshd.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">((ansible_os_family == &quot;RedHat&quot; ) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot; )) and lp_sshd|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_sshd</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">bluetooth.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_bluetooth|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_bluetooth</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">xorg.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_xorg</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cron.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;RedHat&quot; ) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot; )</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_cron</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">modemmanager.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_modemmanager|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_modemmanager</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gpsd.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_gpsd|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpsd</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">postfix.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">((ansible_os_family == &quot;RedHat&quot; ) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot; )) and lp_postfix|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_postfix</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">smart.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_smart|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_smart</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apparmor.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_apparmor|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_apparmor</span>

<span class="p p-Indicator">-</span> <span class="nt">meta</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">flush_handlers</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zeitgeist.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_zeitgeist</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lid.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_lid|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_lid</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">acpi.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_acpi|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_acpi</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">speechd.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_speechd|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_speechd</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nfsd.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_nfsd|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_nfsd</span>

<span class="p p-Indicator">-</span> <span class="nt">meta</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">flush_handlers</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">latex.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_latex|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_latex</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">kvm.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_kvm|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_kvm</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">xen.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_xen|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_xen</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">virtualbox.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_virtualbox|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_virtualbox</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wpagui.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_wpagui|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpagui</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wpasupplicant.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">((ansible_os_family == &quot;RedHat&quot; ) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot; )) and lp_wpasupplicant|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpasupplicant</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">logrotate.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;RedHat&quot; ) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot; )</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_logrotate</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">tlp.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_tlp|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_tlp</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">autofs.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_autofs|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_autofs</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">libvirt.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_libvirt|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_libvirt</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ufw.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_ufw|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">debsums.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_debsums|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_debsums</span>

<span class="p p-Indicator">-</span> <span class="nt">meta</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">flush_handlers</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">service.yml</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_service</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">resolvconf.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;) and lp_resolvconf|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_resolvconf</span>

<span class="p p-Indicator">-</span> <span class="nt">import_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reboot.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">((ansible_os_family == &quot;RedHat&quot; ) or</span>
         <span class="l l-Scalar l-Scalar-Plain">(ansible_os_family == &quot;Debian&quot;)) and lp_reboot|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_reboot</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="acpi-yml">
<span id="as-acpi-yml"></span><h3><a class="toc-backref" href="#id62">acpi.yml</a></h3>
<p>Synopsis: Configure acpi.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/acpi.yml">acpi.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/acpi.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall acpi</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;acpi</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_acpi_dir }}/events&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.value.template</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_acpi_dir</span><span class="nv"> </span><span class="s">}}/events/{{</span><span class="nv"> </span><span class="s">item.value.file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_acpi_owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_acpi_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_acpi_event_mode</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_acpi_events|dict2items</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_acpi_events</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;acpi</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create actions in {{ lp_acpi_dir }}&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.value.template</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_acpi_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">item.value.file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_acpi_owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_acpi_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_acpi_action_mode</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_acpi_actions|dict2items</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_acpi_actions</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="aliases-yml">
<span id="as-aliases-yml"></span><h3><a class="toc-backref" href="#id63">aliases.yml</a></h3>
<p>Synopsis: Configure aliases.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/aliases.yml">aliases.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/aliases.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;aliases</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/aliases&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aliases.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/aliases</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">newaliases</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="apparmor-yml">
<span id="as-apparmor-yml"></span><h3><a class="toc-backref" href="#id64">apparmor.yml</a></h3>
<p>Synopsis: Configure apparmor.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/apparmor.yml">apparmor.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/apparmor.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall apparmor</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;apparmor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_apparmor_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_apparmor_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;apparmor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create list of profiles&quot;</span>
  <span class="nt">block</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;apparmor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">List profiles&quot;</span>
      <span class="nt">shell</span><span class="p">:</span> <span class="s">&quot;aa-status</span><span class="nv"> </span><span class="s">--json</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">jq</span><span class="nv"> </span><span class="s">.profiles</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">jq</span><span class="nv"> </span><span class="s">to_entries&quot;</span>
      <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
      <span class="nt">changed_when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;apparmor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create list of enforced profiles&quot;</span>
      <span class="nt">set_fact</span><span class="p">:</span>
        <span class="nt">lp_apparmor_profiles_enforce</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_apparmor_profiles_enforce|default([])</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">[</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">]</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">result.stdout|default([])</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">item.value == &#39;enforce&#39;</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;apparmor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create list of complained profiles&quot;</span>
      <span class="nt">set_fact</span><span class="p">:</span>
        <span class="nt">lp_apparmor_profiles_complain</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_apparmor_profiles_complain|default([])</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">[</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">]</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">result.stdout|default([])</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">item.value == &#39;complain&#39;</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;apparmor</span><span class="p">:</span> <span class="nt">Debug</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">List enforced profiles&quot;</span>
      <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_apparmor_profiles_enforce</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_debug</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;apparmor</span><span class="p">:</span> <span class="nt">Debug</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">List complained profiles&quot;</span>
      <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_apparmor_profiles_complain</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_debug</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_apparmor_profiles</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;apparmor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Disable profiles&quot;</span>
  <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aa-disable &quot;{{ item }}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_apparmor_disable</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">item in lp_apparmor_profiles_enforce|default([]) or</span>
        <span class="l l-Scalar l-Scalar-Plain">item in lp_apparmor_profiles_complain|default([])</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_apparmor_disable</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;apparmor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Enforce profiles&quot;</span>
  <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aa-enforce &quot;{{ item }}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_apparmor_enforce</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">item not in lp_apparmor_profiles_enforce|default([])</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_apparmor_enforce</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;apparmor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Complain profiles&quot;</span>
  <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">aa-complain &quot;{{ item }}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_apparmor_complain</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">item not in lp_apparmor_profiles_complain|default([])</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_apparmor_enforce</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;apparmor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Start and enable apparmor&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apparmor</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_apparmor|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_apparmor_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;apparmor</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stop and disable apparmor&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apparmor</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_apparmor|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_apparmor_service</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="authorized-keys-yml">
<span id="as-authorized-keys-yml"></span><h3><a class="toc-backref" href="#id65">authorized_keys.yml</a></h3>
<p>Synopsis: Configure authorized_keys.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/authorized_keys.yml">authorized_keys.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/authorized_keys.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;authorized_key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure authorized_keys&quot;</span>
  <span class="nt">authorized_key</span><span class="p">:</span>
    <span class="nt">user</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.user</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">key</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">manage_dir</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_authorized_keys</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="autofs-yml">
<span id="as-autofs-yml"></span><h3><a class="toc-backref" href="#id66">autofs.yml</a></h3>
<p>Synopsis: Configure autofs.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/autofs.yml">autofs.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/autofs.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall autofs</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;autofs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;lp_autofs_enable</span><span class="nv"> </span><span class="s">[</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">lp_autofs_enable</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">]&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_debug|bool</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;autofs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_autofs_conf_file }}&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_autofs_conf_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}\\s*=\\s*(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_autofs_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reload autofs</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;autofs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_autofs_master_conf_file }}&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_autofs_master_conf_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}\\s*(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_autofs_master_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reload autofs</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;autofs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_autofs_misc_conf_file }}&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_autofs_misc_conf_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}\\s*(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_autofs_misc_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reload autofs</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;autofs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Enable and start autofs&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_autofs_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_autofs_enable|bool</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;autofs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stop and disable autofs&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_autofs_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_autofs_enable|bool</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="auto-upgrades-yml">
<span id="as-auto-upgrades-yml"></span><h3><a class="toc-backref" href="#id67">auto_upgrades.yml</a></h3>
<p>Synopsis: Configure auto_upgrades.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/auto_upgrades.yml">auto_upgrades.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/auto_upgrades.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;auto_upgrades</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/apt/apt.conf.d/20auto-upgrades&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">auto-upgrades.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/apt/apt.conf.d/20auto-upgrades</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;auto_upgrades</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Disable and stop unattended-upgrades&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_auto_upgrades_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_auto_upgrades_enable|bool</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;auto_upgrades</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Enable and start unattended-upgrades&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_auto_upgrades_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_auto_upgrades_enable|bool</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="bluetooth-yml">
<span id="as-bluetooth-yml"></span><h3><a class="toc-backref" href="#id68">bluetooth.yml</a></h3>
<p>Synopsis: Configure bluetooth.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/bluetooth.yml">bluetooth.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/bluetooth.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall bluetooth</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;bluetooth</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;lp_bluetooth_enable</span><span class="nv"> </span><span class="s">[{{</span><span class="nv"> </span><span class="s">lp_bluetooth_enable</span><span class="nv"> </span><span class="s">}}]&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_bluetooth_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_bluetooth_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;bluetooth</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/bluetooth/main.conf&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/bluetooth/main.conf</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}\\s*=(.*)$&quot;</span>
    <span class="nt">insertbefore</span><span class="p">:</span> <span class="s">&quot;^{{</span><span class="nv"> </span><span class="s">&#39;#&#39;</span><span class="nv"> </span><span class="s">}}{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}\\s*=(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_bluetooth_main_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart bluetooth</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_bluetooth_conf</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;bluetooth</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Enable and start bluetooth&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_bluetooth_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_bluetooth_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_bluetooth_enable</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;bluetooth</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stop and disable bluetooth&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_bluetooth_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_bluetooth_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_bluetooth_disable</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="cron-yml">
<span id="as-cron-yml"></span><h3><a class="toc-backref" href="#id69">cron.yml</a></h3>
<p>Synopsis: Configure cron.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/cron.yml">cron.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/cron.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;cron</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure cron variables&quot;</span>
  <span class="nt">cronvar</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">user</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.user</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_cron_var</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_cron_var</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;cron</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure cron&quot;</span>
  <span class="nt">cron</span><span class="p">:</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">user</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.user</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">minute</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.minute</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">hour</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.hour</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">day</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.day</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">month</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.month</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">weekday</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.weekday</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">job</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.command</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_cron_tab</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_cron_tab</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="debsums-yml">
<span id="as-debsums-yml"></span><h3><a class="toc-backref" href="#id70">debsums.yml</a></h3>
<p>Synopsis: Configure debsums.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/debsums.yml">debsums.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/debsums.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall debsums</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;debsums</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_debsums_default_file [{{ lp_debsums_default_file }}]</span>
      <span class="no">lp_debsums_default_conf</span>
      <span class="no">{{ lp_debsums_default_conf|to_yaml }}</span>
      <span class="no">lp_debsums_ignore_file [{{ lp_debsums_ignore_file }}]</span>
      <span class="no">lp_debsums_ignore_conf</span>
      <span class="no">{{ lp_debsums_ignore_conf|to_nice_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_debsums_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_debsums_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;debsums</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_debsums_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_debsums_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;debsums</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_debsums_default_file }}&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_debsums_default_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&#39;^\s*{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}\s*=(.*)$&#39;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}={{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_debsums_default_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_debsums_default_conf</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;debsums</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_debsums_ignore_file }}&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_debsums_ignore_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_debsums_ignore_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_debsums_ignore_conf</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="debug-yml">
<span id="as-debug-yml"></span><h3><a class="toc-backref" href="#id71">debug.yml</a></h3>
<p>Synopsis: Configure debug.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/debug.yml">debug.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/debug.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># Hint: Get readable output with stdout_callback = yaml</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">ansible_architecture [{{ ansible_architecture }}]</span>
      <span class="no">ansible_os_family [{{ ansible_os_family }}]</span>
      <span class="no">ansible_distribution [{{ ansible_distribution }}]</span>
      <span class="no">ansible_distribution_major_version [{{ ansible_distribution_major_version }}]</span>
      <span class="no">ansible_distribution_version [{{ ansible_distribution_version }}]</span>
      <span class="no">ansible_distribution_release [{{ ansible_distribution_release }}]</span>
      <span class="no">ansible_python_version [{{ ansible_python_version }}]</span>

      <span class="no">lp_flavors_enable [{{ lp_flavors_enable }}]</span>
      <span class="no">{{ my_release|default([])|to_nice_yaml }}</span>

      <span class="no">lp_backup_conf [{{ lp_backup_conf }}]</span>

      <span class="no">lp_acpi [{{ lp_acpi }}]</span>
      <span class="no">lp_aliases [{{ lp_aliases }}]</span>
      <span class="no">lp_apparmor [{{ lp_apparmor }}]</span>
      <span class="no">lp_auto_upgrades [{{ lp_auto_upgrades }}] lp_auto_upgrades_enable [{{ lp_auto_upgrades_enable }}]</span>
      <span class="no">lp_autofs [{{ lp_autofs }}] lp_autofs_enable [{{ lp_autofs_enable }}]</span>
      <span class="no">lp_bluetooth [{{ lp_bluetooth }}] lp_bluetooth_enable [{{ lp_bluetooth_enable }}]</span>
      <span class="no">lp_debsums [{{ lp_debsums }}]</span>
      <span class="no">lp_gpg [{{ lp_gpg }}]</span>
      <span class="no">lp_gpsd [{{ lp_gpsd }}] lp_gpsd_enable [{{ lp_gpsd_enable }}]</span>
      <span class="no">lp_grub [{{ lp_grub }}]</span>
      <span class="no">lp_iptables [{{ lp_iptables }}]</span>
      <span class="no">lp_kvm [{{ lp_kvm }}]</span>
      <span class="no">lp_latex [{{ lp_latex }}]</span>
      <span class="no">lp_libvirt [{{ lp_libvirt }}]</span>
      <span class="no">lp_libvirt_guests_enable [{{ lp_libvirt_guests_enable }}]</span>
      <span class="no">lp_libvirt_libvirtd_enable [{{ lp_libvirt_libvirtd_enable }}]</span>
      <span class="no">lp_lid [{{ lp_lid }}]</span>
      <span class="no">lp_modemmanager [{{ lp_modemmanager }}] lp_modemmanager_enable [{{ lp_modemmanager_enable }}]</span>
      <span class="no">lp_netplan [{{ lp_netplan }}]</span>
      <span class="no">lp_nfsd [{{ lp_nfsd }}] lp_nfsd_enable [{{ lp_nfsd_enable }}]</span>
      <span class="no">lp_packages_autoremove [{{ lp_packages_autoremove }}]</span>
      <span class="no">lp_passwords [{{ lp_passwords }}]</span>
      <span class="no">lp_pm [{{ lp_pm }}]</span>
      <span class="no">lp_postfix [{{ lp_postfix }}] lp_postfix_enable [{{ lp_postfix_enable }}]</span>
      <span class="no">lp_reboot [{{ lp_reboot }}]</span>
      <span class="no">lp_resolvconf [{{ lp_resolvconf }}]</span>
      <span class="no">lp_smart [{{ lp_smart }}] lp_smart_enable [{{ lp_smart_enable }}]</span>
      <span class="no">lp_speechd [{{ lp_speechd }}] lp_speechd_enable [{{ lp_speechd_enable }}]</span>
      <span class="no">lp_ssh [{{ lp_ssh }}]</span>
      <span class="no">lp_sshd [{{ lp_sshd }}] lp_sshd_enable [{{ lp_sshd_enable }}]</span>
      <span class="no">lp_swap [{{ lp_swap }}] lp_swap_enable [{{ lp_swap_enable }}]</span>
      <span class="no">lp_timesyncd [{{ lp_timesyncd }}] lp_timesyncd_enable [{{ lp_timesyncd_enable }}]</span>
      <span class="no">lp_timezone [{{ lp_timezone }}]</span>
      <span class="no">lp_tlp [{{ lp_tlp }}] lp_tlp_enable [{{ lp_tlp_enable }}]</span>
      <span class="no">lp_ufw [{{ lp_ufw }}]</span>
      <span class="no">lp_virtualbox [{{ lp_virtualbox }}] lp_virtualbox_enable [{{ lp_virtualbox_enable }}]</span>
      <span class="no">lp_wpagui [{{ lp_wpagui }}]</span>
      <span class="no">lp_wpasupplicant [{{ lp_wpasupplicant }}]</span>
      <span class="no">lp_xen [{{ lp_xen }}]</span>
      <span class="no">lp_zeitgeist [{{ lp_zeitgeist }}]</span>
      <span class="no">lp_zfs [{{ lp_zfs }}]</span>

      <span class="no">lp_service</span>
      <span class="no">{{ lp_service | to_yaml }}</span>
      <span class="no">lp_package_state [{{ lp_package_state }}]</span>
      <span class="no">lp_package_state_remove [{{ lp_package_state_remove }}]</span>

  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="fstab-yml">
<span id="as-fstab-yml"></span><h3><a class="toc-backref" href="#id72">fstab.yml</a></h3>
<p>Synopsis: Configure fstab.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/fstab.yml">fstab.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/fstab.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;fstab</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure fstab entries&quot;</span>
  <span class="nt">mount</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state|default(&#39;mounted&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">src</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.src|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">fstype</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.fstype|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">opts</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.opts|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">dump</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.dump|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">passno</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.passno|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_fstab_entries</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="gpg-yml">
<span id="as-gpg-yml"></span><h3><a class="toc-backref" href="#id73">gpg.yml</a></h3>
<p>Synopsis: Configure gpg.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/gpg.yml">gpg.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/gpg.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall gpg</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;gpg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_gpg_install [{{ lp_gpg_install }}]</span>
      <span class="no">lp_gpg_packages</span>
      <span class="no">{{ lp_gpg_packages|to_nice_yaml }}</span>
      <span class="no">lp_gpg_packages_extra</span>
      <span class="no">{{ lp_gpg_packages_extra|to_nice_yaml }}</span>

      <span class="no">lp_gpg_conf_default</span>
      <span class="no">{{ lp_gpg_conf_default|to_yaml }}</span>
      <span class="no">lp_gpg_conf</span>
      <span class="no">{{ lp_gpg_conf|to_yaml }}</span>

      <span class="no">lp_gpg_agent_conf_default</span>
      <span class="no">{{ lp_gpg_agent_conf_default|to_yaml }}</span>
      <span class="no">lp_gpg_agent_conf</span>
      <span class="no">{{ lp_gpg_agent_conf|to_yaml }}</span>

      <span class="no">lp_gpg_dirmngr_conf_default</span>
      <span class="no">{{ lp_gpg_dirmngr_conf_default|to_yaml }}</span>
      <span class="no">lp_gpg_dirmngr_conf</span>
      <span class="no">{{ lp_gpg_dirmngr_conf|to_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpg_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpg_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;gpg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_gpg_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_gpg_packages_extra</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpg_install|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpg_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;gpg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure gpg.conf&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gpg.conf.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.dest|default(&#39;/home/&#39;</span><span class="nv"> </span><span class="s">~</span><span class="nv"> </span><span class="s">item.owner</span><span class="nv"> </span><span class="s">~</span><span class="nv"> </span><span class="s">&#39;/.gnupg/gpg.conf&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0600&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_gpg_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop_control</span><span class="p">:</span>
    <span class="nt">label</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpg_conf</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;gpg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure gpg-agent.conf&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gpg-agent.conf.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.dest|default(&#39;/home/&#39;</span><span class="nv"> </span><span class="s">~</span><span class="nv"> </span><span class="s">item.owner</span><span class="nv"> </span><span class="s">~</span><span class="nv"> </span><span class="s">&#39;/.gnupg/gpg-agent.conf&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0600&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_gpg_agent_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop_control</span><span class="p">:</span>
    <span class="nt">label</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpg_agent_conf_changes</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gpgconf kill gpg-agent</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpg_agent_conf</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;gpg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure dirmngr.conf&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gpg-dirmngr.conf.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.dest|default(&#39;/home/&#39;</span><span class="nv"> </span><span class="s">~</span><span class="nv"> </span><span class="s">item.owner</span><span class="nv"> </span><span class="s">~</span><span class="nv"> </span><span class="s">&#39;/.gnupg/dirmngr.conf&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0600&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_gpg_dirmngr_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop_control</span><span class="p">:</span>
    <span class="nt">label</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpg_dirmngr_conf_changes</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gpgconf kill dirmngr</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpg_dirmngr_conf</span>

<span class="c1"># TODO: import keys</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="gpsd-yml">
<span id="as-gpsd-yml"></span><h3><a class="toc-backref" href="#id74">gpsd.yml</a></h3>
<p>Synopsis: Configure gpsd.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/gpsd.yml">gpsd.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/gpsd.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall gpsd</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;gpsd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages for gpsd&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_gpsd_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpsd_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;gpsd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Add user gpsd to group dialout&quot;</span>
  <span class="nt">user</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gpsd</span>
    <span class="nt">groups</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">dialout</span>
    <span class="nt">append</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpsd_group</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;gpsd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/bluetooth/rfcomm.conf&quot;</span>
  <span class="nt">blockinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/bluetooth/rfcomm.conf</span>
    <span class="nt">marker</span><span class="p">:</span> <span class="s">&quot;#</span><span class="nv"> </span><span class="s">{mark}</span><span class="nv"> </span><span class="s">ANSIBLE</span><span class="nv"> </span><span class="s">MANAGED</span><span class="nv"> </span><span class="s">BLOCK</span><span class="nv"> </span><span class="s">rfcomm{{</span><span class="nv"> </span><span class="s">item.rfcomm</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">insertafter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EOF</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">block</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">rfcomm{{ item.rfcomm }} {</span>
        <span class="no">bind {{ item.bind }}</span>
        <span class="no">device {{ item.device }}</span>
        <span class="no">channel {{ item.channel }}</span>
        <span class="no">comment &quot;{{ item.comment }}&quot;</span>
        <span class="no">}</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_gpsd_bt_rfcomm</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart bluetooth</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpsd_bt_rfcom</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;gpsd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/default/gpsd&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">gpsd.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/default/gpsd</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart gpsd</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpsd_config</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;gpsd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stop and disable gpsd&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_gpsd_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_gpsd_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpsd_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;gpsd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Start and enable gpsd&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_gpsd_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpsd_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_gpsd_service</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="grub-yml">
<span id="as-grub-yml"></span><h3><a class="toc-backref" href="#id75">grub.yml</a></h3>
<p>Synopsis: Configure grub.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/grub.yml">grub.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/grub.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;grub</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_grub_default</span>
      <span class="no">{{ lp_grub_default|to_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_grub_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_grub_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;grub</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/default/grub&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/default/grub</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^\\s*{{</span><span class="nv"> </span><span class="s">item.var</span><span class="nv"> </span><span class="s">}}\\s*=(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.var</span><span class="nv"> </span><span class="s">}}={{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf|bool</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_grub_default</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">update grub</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_grub_conf</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="hostname-yml">
<span id="as-hostname-yml"></span><h3><a class="toc-backref" href="#id76">hostname.yml</a></h3>
<p>Synopsis: Configure hostname.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/hostname.yml">hostname.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/hostname.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="c1"># TODO:</span>
<span class="c1"># 1) SET/DONT_SET hostname via DHCP</span>
<span class="c1"># /etc/dhcp/dhclient.conf</span>
<span class="c1"># #send host-name = gethostname();</span>
<span class="c1"># request host-name = &quot;myhostname&quot;;</span>
<span class="c1"># https://askubuntu.com/questions/104918/how-to-get-the-hostname-from-a-dhcp-server</span>
<span class="c1"># http://blog.schlomo.schapiro.org/2013/11/setting-hostname-from-dhcp-in-debian.html</span>
<span class="c1"># https://askubuntu.com/questions/757423/how-to-force-dhcp-client-to-allow-a-self-defined-domain-name</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;hostname</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure hostname in /etc/hostname&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hostname.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/hostname</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lp_hostname|length &gt; 0</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>
<span class="c1">#  notify: set hostname</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;hostname</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure hostname&quot;</span>
  <span class="nt">hostname</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_hostname|length &gt; 0</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="hosts-yml">
<span id="as-hosts-yml"></span><h3><a class="toc-backref" href="#id77">hosts.yml</a></h3>
<p>Synopsis: Configure hosts.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/hosts.yml">hosts.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/hosts.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_hosts_default_override</span>
      <span class="no">{{ lp_hosts_default_override|default(&#39;UNDEFINED&#39;)|to_yaml }}</span>
      <span class="no">lp_hosts_default</span>
      <span class="no">{{ lp_hosts_default|to_yaml }}</span>
      <span class="no">lp_hosts</span>
      <span class="no">{{ lp_hosts|to_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_hosts_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_hosts_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure hosts in /etc/hosts&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hosts.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/hosts</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_hosts_conf</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="iptables-yml">
<span id="as-iptables-yml"></span><h3><a class="toc-backref" href="#id78">iptables.yml</a></h3>
<p>Synopsis: Configure iptables.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/iptables.yml">iptables.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/iptables.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall iptables</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;iptables</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create /etc/network/if-pre-up.d/iptables&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">iptables-restore.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/network/if-pre-up.d/iptables</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0755&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;iptables</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create /etc/network/iptables</span>
                   <span class="l l-Scalar l-Scalar-Plain">using {{ lp_iptables_type }}-iptables.j2&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_iptables_type</span><span class="nv"> </span><span class="s">}}-iptables.j2&quot;</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/network/iptables</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reload iptables</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="kvm-yml">
<span id="as-kvm-yml"></span><h3><a class="toc-backref" href="#id79">kvm.yml</a></h3>
<p>Synopsis: Configure kvm.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/kvm.yml">kvm.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/kvm.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall kvm</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;kvm</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_kvm_packages</span>
      <span class="no">{{ lp_kvm_packages|to_nice_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_kvm_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_kvm_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;kvm</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_kvm_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_kvm_packages</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="latex-yml">
<span id="as-latex-yml"></span><h3><a class="toc-backref" href="#id80">latex.yml</a></h3>
<p>Synopsis: Configure latex.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/latex.yml">latex.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/latex.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall LaTeX</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;latex</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_latex_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_latex_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;latex</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create directory /usr/share/texmf/tex/latex&quot;</span>
  <span class="nt">file</span><span class="p">:</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">directory</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/usr/share/texmf/tex/latex</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_latex_dir</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;latex</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create directories for macros&quot;</span>
  <span class="nt">file</span><span class="p">:</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">directory</span>
    <span class="nt">path</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.dest</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_latex_macros</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_latex_macros</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;latex</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Download macros&quot;</span>
  <span class="nt">get_url</span><span class="p">:</span>
    <span class="nt">url</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.url</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.dest</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">timeout</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_latex_download_timeout</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_latex_macros</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">ignore_errors</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_latex_get_url_ignore_errors</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">changed_when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_latex_labels</span>

<span class="c1"># get_url: check mode reports changes with force enabled</span>
<span class="c1"># https://github.com/ansible/ansible/issues/25418</span>

<span class="c1"># TODO:</span>
<span class="c1"># 1) Compile and register labels.sty</span>
<span class="c1"># cd /usr/share/texmf/tex/latex/labels/</span>
<span class="c1"># latex labels.ins</span>
<span class="c1"># texhash /usr/share/texmf</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="libvirt-conf-yml">
<span id="as-libvirt-conf-yml"></span><h3><a class="toc-backref" href="#id81">libvirt-conf.yml</a></h3>
<p>Synopsis: Configure libvirt-conf.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/libvirt-conf.yml">libvirt-conf.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/libvirt-conf.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;libvirt-conf</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_libvirt_debug|bool</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;libvirt-conf</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_libvirt_conf_dir }}/{{ item.key }}&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_libvirt_conf_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^{{</span><span class="nv"> </span><span class="s">conf[0]</span><span class="nv"> </span><span class="s">}}(\\s|=)&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">conf[0]</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">conf[1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">conf[2]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(&#39;present&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop_control</span><span class="p">:</span>
    <span class="nt">loop_var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">conf</span>
  <span class="nt">notify</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">reload libvirtd</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">reload libvirt_guests</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="libvirt-yml">
<span id="as-libvirt-yml"></span><h3><a class="toc-backref" href="#id82">libvirt.yml</a></h3>
<p>Synopsis: Configure libvirt.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/libvirt.yml">libvirt.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/libvirt.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall libvirt</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;libvirt</span><span class="nv"> </span><span class="s">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_libvirt_guests_enable [{{ lp_libvirt_guests_enable }}]</span>
      <span class="no">lp_libvirt_libvirtd_enable [{{ lp_libvirt_libvirtd_enable }}]</span>
      <span class="no">lp_libvirt_backup [{{ lp_libvirt_backup }}]</span>
      <span class="no">lp_libvirt_conf_owner [{{ lp_libvirt_conf_owner }}]</span>
      <span class="no">lp_libvirt_conf_group [{{ lp_libvirt_conf_group }}]</span>
      <span class="no">lp_libvirt_conf_mode [{{ lp_libvirt_conf_mode }}]</span>
      <span class="no">lp_libvirt_conf_dir [{{ lp_libvirt_conf_dir }}]</span>
      <span class="no">lp_libvirt_packages</span>
      <span class="no">{{ lp_libvirt_packages|to_nice_yaml }}</span>
      <span class="no">lp_libvirt_conf</span>
      <span class="no">{{ lp_libvirt_conf|to_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_libvirt_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_libvirt_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;libvirt</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_libvirt_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_libvirt_pkg</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;libvirt</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">libvirt-conf.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_libvirt_conf</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">dict2items</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_libvirt_conf</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;libvirt</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Start and enable {{ lp_libvirt_libvirtd_service }}&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_libvirt_libvirtd_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_libvirt_libvirtd_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_libvirt_libvirtd_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;libvirt</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stop and disable {{ lp_libvirt_libvirtd_service }}&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_libvirt_libvirtd_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_libvirt_libvirtd_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_libvirt_libvirtd_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;libvirt</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Start and enable {{ lp_libvirt_guests_service }}&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_libvirt_guests_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_libvirt_guests_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_libvirt_guests_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;libvirt</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stop and disable {{ lp_libvirt_guests_service }}&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_libvirt_guests_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_libvirt_guests_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_libvirt_guests_service</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="lid-yml">
<span id="as-lid-yml"></span><h3><a class="toc-backref" href="#id83">lid.yml</a></h3>
<p>Synopsis: Configure lid.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/lid.yml">lid.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/lid.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall lid</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;lid</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_lid_logind_conf }}&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_lid_logind_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^\\s*{{</span><span class="nv"> </span><span class="s">item.var</span><span class="nv"> </span><span class="s">}}\\s*=\\s*(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.var</span><span class="nv"> </span><span class="s">}}={{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_lid_logind_conf_vars</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">logind message reboot</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;lid</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_lid_upower_conf }}&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_lid_upower_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^\\s*{{</span><span class="nv"> </span><span class="s">item.var</span><span class="nv"> </span><span class="s">}}\\s*=\\s*(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.var</span><span class="nv"> </span><span class="s">}}={{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_lid_upower_conf_vars</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="logrotate-yml">
<span id="as-logrotate-yml"></span><h3><a class="toc-backref" href="#id84">logrotate.yml</a></h3>
<p>Synopsis: Configure logrotate.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/logrotate.yml">logrotate.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/logrotate.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall logrotate</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;logrotate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages for logrotate&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_logrotate_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;logrotate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure blocks in {{ lp_logrotate_conf_file }}&quot;</span>
  <span class="nt">blockinfile</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_logrotate_conf_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mark</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.mark</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">block</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.block</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_logrotate_conf_blocks</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;logrotate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure lines in {{ lp_logrotate_conf_file }}&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_logrotate_conf_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.line</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_logrotate_conf_lines</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;logrotate</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_logrotate_conf_dir }}&quot;</span>
  <span class="nt">blockinfile</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_logrotate_conf_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">item.path</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">block</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_logrotate_confd</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="modemmanager-yml">
<span id="as-modemmanager-yml"></span><h3><a class="toc-backref" href="#id85">modemmanager.yml</a></h3>
<p>Synopsis: Configure modemmanager.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/modemmanager.yml">modemmanager.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/modemmanager.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall ModemManager</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;modem_manager</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/init/modemmanager.override&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">modem-manager-override.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/init/modemmanager.override</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;modem_manager</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stop and disable ModemManager&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ModemManager</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_modemmanager_enable|bool</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;modem_manager</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Start and enable ModemManager&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ModemManager</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_modemmanager_enable|bool</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="modules-yml">
<span id="as-modules-yml"></span><h3><a class="toc-backref" href="#id86">modules.yml</a></h3>
<p>Synopsis: Configure modules.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/modules.yml">modules.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/modules.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall modules</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;modules</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_modules_conf [{{ lp_modules_conf }}]</span>
      <span class="no">lp_modules</span>
      <span class="no">{{ lp_modules|to_yaml }}</span>
      <span class="no">lp_modules_options_path [ {{ lp_modules_options_path }}]</span>
      <span class="no">lp_modules_options</span>
      <span class="no">{{ lp_modules_options|to_nice_yaml }}</span>
      <span class="no">lp_modules_blacklist_path [{{ lp_modules_blacklist_path }}]</span>
      <span class="no">lp_modules_blacklist</span>
      <span class="no">{{ lp_modules_blacklist|to_nice_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_modules_debug|bool</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;modules</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">modprobe modules&quot;</span>
  <span class="nt">modprobe</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">params</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.params</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state|default(&#39;present&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_modules</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="c1"># Debian</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;modules</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_modules_conf }} in Debian&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_modules_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^\\s*{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}\\s*(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.params</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_modules</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">item.state|default(&quot;present&quot;) == &quot;present&quot;</span>

<span class="c1"># RedHat</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;modules</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_modules_conf }} in RedHat&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_modules_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^\\s*modprobe\\s+{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}\\s*(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;modprobe</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.params</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_modules</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;RedHat&quot;</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">item.state|default(&quot;present&quot;) == &quot;present&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;modules</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Blacklist modules in {{ lp_modules_blacklist_path }}&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blacklist-module.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_modules_blacklist_path</span><span class="nv"> </span><span class="s">}}/blacklist-{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}.conf&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_modules_blacklist</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">update initramfs</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;modules</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Set modules options in {{ lp_modules_options_path }}&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">options-module.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_modules_options_path</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">item.module</span><span class="nv"> </span><span class="s">}}.conf&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_modules_options</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">update initramfs</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="netplan-yml">
<span id="as-netplan-yml"></span><h3><a class="toc-backref" href="#id87">netplan.yml</a></h3>
<p>Synopsis: Configure netplan.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/netplan.yml">netplan.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/netplan.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall netplan</span>
</span>
<span class="c1"># Configure 01-network-manager-all.yaml only if it already exists</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;netplan</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stat {{ lp_netplan_default }}&quot;</span>
  <span class="nt">stat</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_netplan_root</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">lp_netplan_default</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;netplan</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_netplan_root }}/{{ lp_netplan_default }}&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">netplan-default.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_netplan_root</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">lp_netplan_default</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_netplan_owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_netplan_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_netplan_mode</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">netplan apply</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result.stat.exists|default(false)</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;netplan</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure files in {{ lp_netplan_root }}&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">netplan-conf.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_netplan_root</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">item.file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.owner</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(lp_netplan_owner)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.group</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(lp_netplan_group)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.mode</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(lp_netplan_mode)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_netplan_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">netplan apply</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="nfsd-yml">
<span id="as-nfsd-yml"></span><h3><a class="toc-backref" href="#id88">nfsd.yml</a></h3>
<p>Synopsis: Configure nfsd.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/nfsd.yml">nfsd.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/nfsd.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall nfsd</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;nfsd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_nfsd_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_nfsd_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;nfsd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure exports&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">exports.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/exports</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reload nfsd</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_nfsd_exports</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;nfsd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Enable and start nfsd services&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_nfsd_services</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lp_nfsd_enable|bool</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lp_nfsd_services|length &gt; 0</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_nfsd_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;nfsd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stop and disable nfsd services&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_nfsd_services</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">not lp_nfsd_enable|bool</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lp_nfsd_services|length &gt; 0</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_nfsd_service</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="packages-auto-yml">
<span id="as-packages-auto-yml"></span><h3><a class="toc-backref" href="#id89">packages-auto.yml</a></h3>
<p>Synopsis: Configure packages-auto.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/packages-auto.yml">packages-auto.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/packages-auto.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall packages-auto</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;packages-auto</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Init variable local_pkg_lists&quot;</span>
  <span class="nt">set_fact</span><span class="p">:</span>
    <span class="nt">local_pkg_lists</span><span class="p">:</span> <span class="p p-Indicator">[]</span>
    <span class="nt">local_pkg_list</span><span class="p">:</span> <span class="p p-Indicator">[]</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_auto</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;packages-auto</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">List variables ^lp_.*_packages$&quot;</span>
  <span class="nt">set_fact</span><span class="p">:</span>
    <span class="nt">local_pkg_lists</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">local_pkg_lists</span><span class="nv"> </span><span class="s">+</span>
                     <span class="s">[{&#39;install&#39;:</span><span class="nv"> </span><span class="s">item.split(&#39;_&#39;)[0]</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">&#39;_&#39;</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">item.split(&#39;_&#39;)[1],</span>
                       <span class="s">&#39;packages&#39;:</span><span class="nv"> </span><span class="s">item}]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">hostvars[inventory_hostname].keys()|</span>
            <span class="s">select(&#39;match&#39;,</span><span class="nv"> </span><span class="s">&#39;^lp_.*_packages$&#39;)|</span>
            <span class="s">list</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_auto</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;packages-auto</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug local_pkg_lists&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;[{{</span><span class="nv"> </span><span class="s">lookup(&#39;vars&#39;,</span><span class="nv"> </span><span class="s">item.install,</span><span class="nv"> </span><span class="s">default=&#39;false&#39;)|bool</span><span class="nv"> </span><span class="s">}}]</span>
              <span class="s">packages</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">lookup(&#39;vars&#39;,</span><span class="nv"> </span><span class="s">item.packages)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">local_pkg_lists</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_auto</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;packages-auto</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create local_pkg_list&quot;</span>
  <span class="nt">set_fact</span><span class="p">:</span>
    <span class="nt">local_pkg_list</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">local_pkg_list</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">lookup(&#39;vars&#39;,</span><span class="nv"> </span><span class="s">item.packages)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">local_pkg_lists</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lookup(&#39;vars&#39;, item.install, default=&#39;False&#39;)|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_auto</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;packages-auto</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug local_pkg_list&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">local_pkg_list</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_auto</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;packages-auto</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">local_pkg_list</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_auto</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="packages-yml">
<span id="as-packages-yml"></span><h3><a class="toc-backref" href="#id90">packages.yml</a></h3>
<p>Synopsis: Configure packages.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/packages.yml">packages.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/packages.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall packages</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;packages</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">ansible_os_family [{{ ansible_os_family }}]</span>
      <span class="no">lp_packages_auto [{{ lp_packages_auto }}]</span>
      <span class="no">lp_packages_autoremove [{{ lp_packages_autoremove }}]</span>
      <span class="no">lp_packages_selections_preinstall</span>
      <span class="no">{{ lp_packages_selections_preinstall|to_nice_yaml }}</span>
      <span class="no">lp_packages_install</span>
      <span class="no">{{ lp_packages_install|to_nice_yaml }}</span>
      <span class="no">lp_packages_remove</span>
      <span class="no">{{ lp_packages_remove|to_nice_yaml }}</span>
      <span class="no">lp_packages_selections_postinstall</span>
      <span class="no">{{ lp_packages_selections_postinstall|to_nice_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;packages</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure package selections before Install/Remove&quot;</span>
  <span class="nt">dpkg_selections</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">selection</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.selection</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_packages_selections_preinstall</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_selections_preinstall</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;packages</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages listed in variables lp_*_packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">packages-auto.yml</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_auto|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_auto</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;packages</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_packages_install</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_install</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;packages</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Remove packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/remove-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_packages_remove</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_remove</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;packages</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure package selections after Install/Remove&quot;</span>
  <span class="nt">dpkg_selections</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">selection</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.selection</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_packages_selections_postinstall</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_packages_selections_postinstall</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="passwords-yml">
<span id="as-passwords-yml"></span><h3><a class="toc-backref" href="#id91">passwords.yml</a></h3>
<p>Synopsis: Configure passwords.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/passwords.yml">passwords.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/passwords.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;passwords</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_passwords_fail_gracefully [{{ lp_passwords_fail_gracefully }}]</span>
      <span class="no">lp_password_update_password [{{ lp_password_update_password }}]</span>
      <span class="no">lp_users</span>
      <span class="no">{% if lp_passwords_debug_classified|bool %}</span>
      <span class="no">{{ lp_users|default([])|to_nice_yaml }}</span>
      <span class="no">{% else %}</span>
      <span class="no">{% for user in lp_users|default([]) %}</span>
      <span class="no">- userpass: ************</span>
      <span class="no">{% for k,v in user.items() %}</span>
      <span class="no">{% if k not in [&#39;userpass&#39;] %}</span>
        <span class="no">{{ k }}: {{ v }}</span>
      <span class="no">{% endif %}</span>
      <span class="no">{% endfor %}</span>
      <span class="no">{% endfor %}</span>
      <span class="no">{% endif %}</span>

      <span class="no">lp_passwordstore [{{ lp_passwordstore }}]</span>
      <span class="no">lp_passwordstore_install [{{ lp_passwordstore_install }}]</span>
      <span class="no">lp_passwordstore_debug [{{ lp_passwordstore_debug }}]</span>
      <span class="no">lp_passwordstore_backup [{{ lp_passwordstore_backup }}]</span>
      <span class="no">lp_passwordstore_create [{{ lp_passwordstore_create }}]</span>
      <span class="no">lp_passwordstore_length [{{ lp_passwordstore_length }}]</span>
      <span class="no">lp_passwordstore_nosymbols [{{ lp_passwordstore_nosymbols }}]</span>
      <span class="no">lp_passwordstore_overwrite [{{ lp_passwordstore_overwrite }}]</span>
      <span class="no">lp_passwordstore_passwordstore [{{ lp_passwordstore_passwordstore }}]</span>
      <span class="no">lp_passwordstore_returnall  [{{ lp_passwordstore_returnall }}]</span>
      <span class="no">lp_passwordstore_subkey [{{ lp_passwordstore_subkey }}]</span>
      <span class="no">lp_passwordstore_idempotent_password_hash [{{ lp_passwordstore_idempotent_password_hash }}]</span>
      <span class="no">lp_passwordstore_packages</span>
      <span class="no">{{ lp_passwordstore_packages|to_nice_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_passwords_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_passwords_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;passwords</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Passwordstore&quot;</span>
  <span class="nt">block</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;passwords</span><span class="p">:</span> <span class="nt">Passwordstore</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
      <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
      <span class="nt">loop</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_passwordstore_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_gpg_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_gpg_packages_extra</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">vars</span><span class="p">:</span>
        <span class="nt">my_delegate_to_localhost</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">run_once</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_passwordstore_install|bool</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;passwords</span><span class="p">:</span> <span class="nt">Passwordstore</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Retrieve, create, or update userpass&quot;</span>
      <span class="nt">include_role</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">vbotka.ansible_lib</span>
        <span class="nt">tasks_from</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">al_pws_user_host.yml</span>
      <span class="nt">vars</span><span class="p">:</span>
        <span class="nt">al_pws_debug</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_passwordstore_debug</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">al_pws_backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_passwordstore_backup</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">al_pws_create</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_passwordstore_create</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">al_pws_length</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_passwordstore_length</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">al_pws_nosymbols</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_passwordstore_nosymbols</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">al_pws_overwrite</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_passwordstore_overwrite</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">al_pws_passwordstore</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_passwordstore_passwordstore</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">al_pws_returnall</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_passwordstore_returnall</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">al_pws_subkey</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_passwordstore_subkey</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">al_pws_idempotent_password_hash</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_passwordstore_idempotent_password_hash</span><span class="nv"> </span><span class="s">}}&quot;</span>
        <span class="nt">al_pws_query</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_users</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;passwords</span><span class="p">:</span> <span class="nt">Passwordstore</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create my_passwords&quot;</span>
      <span class="nt">set_fact</span><span class="p">:</span>
        <span class="nt">my_passwords</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">my_passwords|default([])</span><span class="nv"> </span><span class="s">+</span>
                          <span class="s">[item|dict2items|</span>
                          <span class="s">rejectattr(&#39;key&#39;,</span><span class="nv"> </span><span class="s">&#39;equalto&#39;,</span><span class="nv"> </span><span class="s">&#39;userpass&#39;)|</span>
                          <span class="s">list|items2dict|</span>
                          <span class="s">combine({&#39;update_password&#39;:</span><span class="nv"> </span><span class="s">lp_password_update_password})]</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">al_pws_query_result</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">loop_control</span><span class="p">:</span>
        <span class="nt">label</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;passwords</span><span class="p">:</span> <span class="nt">Passwordstore</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug my_passwords&quot;</span>
      <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">my_passwords</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_passwords_debug|bool</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;passwords</span><span class="p">:</span>  <span class="nt">Passwordstore</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Include users&quot;</span>
      <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">users.yml</span>
      <span class="nt">vars</span><span class="p">:</span>
        <span class="nt">lp_users</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">my_passwords</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">rescue</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;passwords</span><span class="p">:</span> <span class="nt">Passwordstore</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug fail&quot;</span>
      <span class="nt">debug</span><span class="p">:</span>
        <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_passwords_debug_classified|bool</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;passwords</span><span class="p">:</span> <span class="nt">Passwordstore</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Fail&quot;</span>
      <span class="nt">fail</span><span class="p">:</span>
        <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;[ERROR]</span><span class="nv"> </span><span class="s">Passwordstore</span><span class="nv"> </span><span class="s">failed.&quot;</span>
      <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_passwords_fail_gracefully|bool</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_passwordstore|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_passwords_passwordstore</span>

<span class="c1">#  EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="pm-utils-yml">
<span id="as-pm-utils-yml"></span><h3><a class="toc-backref" href="#id92">pm-utils.yml</a></h3>
<p>Synopsis: Configure pm-utils.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/pm-utils.yml">pm-utils.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/pm-utils.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall pm-utils</span>
</span>
<span class="c1"># TODO:</span>
<span class="c1"># 1) add variables: lp_pm_powerd, lp_pm_configd</span>
<span class="c1"># 2) add templates: pm-powerd.j2, pm-configd.j2</span>
<span class="c1"># 3) add cases: resume, thaw, suspend, hibernate</span>
<span class="c1"># 4) install pm-utils</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;pm_utils</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/pm/sleep.d&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">pm-sleepd.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;/etc/pm/sleep.d/{{</span><span class="nv"> </span><span class="s">item.value.file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0755&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">with_dict</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_pm_sleepd|default({})</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">item.value.file|length &gt; 0</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="postfix-yml">
<span id="as-postfix-yml"></span><h3><a class="toc-backref" href="#id93">postfix.yml</a></h3>
<p>Synopsis: Configure postfix.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/postfix.yml">postfix.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/postfix.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall postfix</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;postfix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">ansible_os_family [{{ ansible_os_family }}]</span>
      <span class="no">lp_postfix_service [{{ lp_postfix_service }}]</span>
      <span class="no">lp_postfix_enable [{{ lp_postfix_enable }}]</span>
      <span class="no">lp_postfix_main_conf</span>
      <span class="no">{{ lp_postfix_main_conf|to_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_postfix_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_postfix_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;postfix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/postfix/main.cf&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/postfix/main.cf</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^\\s*{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}\\s*=\\s*(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_postfix_main_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reload postfix</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_postfix_conf</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;postfix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Enable and start postfix&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_postfix_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_postfix_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_postfix_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;postfix</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Disable and stop postfix&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_postfix_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_postfix_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_postfix_service</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="reboot-yml">
<span id="as-reboot-yml"></span><h3><a class="toc-backref" href="#id94">reboot.yml</a></h3>
<p>Synopsis: Configure reboot.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/reboot.yml">reboot.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/reboot.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall reboot</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;reboot</span><span class="nv"> </span><span class="s">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_reboot_force [{{ lp_reboot_force }}]</span>
      <span class="no">lp_reboot_required_ignore [{{ lp_reboot_required_ignore }}]</span>
      <span class="no">lp_reboot_required_file [{{ lp_reboot_required_file }}]</span>
      <span class="no">lp_reboot_command [{{ lp_reboot_command }}]</span>
      <span class="no">lp_reboot_wait_connect_timeout [{{ lp_reboot_wait_connect_timeout }}]</span>
      <span class="no">lp_reboot_wait_sleep [{{ lp_reboot_wait_sleep }}]</span>
      <span class="no">lp_reboot_wait_delay [{{ lp_reboot_wait_delay }}]</span>
      <span class="no">lp_reboot_wait_timeout [{{ lp_reboot_wait_timeout }}]</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_reboot_debug|bool</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;reboot</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debian test {{ lp_reboot_required_file }}&quot;</span>
  <span class="nt">block</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;reboot</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stat {{ lp_reboot_required_file }}&quot;</span>
      <span class="nt">stat</span><span class="p">:</span>
        <span class="nt">path</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_reboot_required_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reboot_required_file_status</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;reboot</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Set reboot_required&quot;</span>
      <span class="nt">set_fact</span><span class="p">:</span>
        <span class="nt">reboot_required</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">reboot_required_file_status.exists|</span>
                             <span class="s">default(false)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;reboot</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RedHat test {{ lp_reboot_required_command }}&quot;</span>
  <span class="nt">block</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;reboot</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Run {{ lp_reboot_required_command }}&quot;</span>
      <span class="nt">command</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_reboot_required_command</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reboot_required_cmd_status</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;reboot</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Set reboot_required&quot;</span>
      <span class="nt">set_fact</span><span class="p">:</span>
        <span class="nt">reboot_required</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">(reboot_required_cmd_status.rc</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">0)|</span>
                              <span class="s">ternary(true,</span><span class="nv"> </span><span class="s">false)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;RedHat&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;reboot</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug reboot_required&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reboot_required</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_reboot_debug|bool</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;reboot</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Reboot and wait for connection&quot;</span>
  <span class="nt">reboot</span><span class="p">:</span>
    <span class="nt">connect_timeout</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_reboot_wait_connect_timeout</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">post_reboot_delay</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_reboot_wait_delay</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">reboot_timeout</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_reboot_wait_timeout</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(reboot_required|default(false) and</span>
        <span class="l l-Scalar l-Scalar-Plain">(not lp_reboot_required_ignore)) or</span>
        <span class="l l-Scalar l-Scalar-Plain">lp_reboot_force|bool</span>

<span class="c1"># - name: &quot;reboot: Reboot and wait for connection&quot;</span>
<span class="c1">#   block:</span>
<span class="c1">#     - name: &quot;reboot: Reboot&quot;  # noqa 305</span>
<span class="c1">#       shell: &quot;{{ lp_reboot_command }}&quot;</span>
<span class="c1">#       async: 1</span>
<span class="c1">#       poll: 0</span>
<span class="c1">#     - name: &quot;reboot: Wait for connection&quot;</span>
<span class="c1">#       wait_for_connection:</span>
<span class="c1">#         connect_timeout: &quot;{{ lp_reboot_wait_connect_timeout }}&quot;</span>
<span class="c1">#         sleep: &quot;{{ lp_reboot_wait_sleep }}&quot;</span>
<span class="c1">#         delay: &quot;{{ lp_reboot_wait_delay }}&quot;</span>
<span class="c1">#         timeout: &quot;{{ lp_reboot_wait_timeout }}&quot;</span>
<span class="c1">#   when: (reboot_required|default(false) and</span>
<span class="c1">#         (not lp_reboot_required_ignore)) or lp_reboot_force</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="repos-yml">
<span id="as-repos-yml"></span><h3><a class="toc-backref" href="#id95">repos.yml</a></h3>
<p>Synopsis: Configure repos.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/repos.yml">repos.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/repos.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall repos</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;repos</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_repos_keys</span>
      <span class="no">{{ lp_repos_keys|to_nice_yaml }}</span>
      <span class="no">lp_repos</span>
      <span class="no">{{ lp_repos|to_nice_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_repos_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_repos_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;repos</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Manage repo signing keys&quot;</span>
  <span class="nt">apt_key</span><span class="p">:</span>
    <span class="nt">data</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.data|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">file</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.file|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">id</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.id|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">keyring</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.keyring|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">keyserver</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.keyserver|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">url</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.url|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">validate_certs</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.validate_certs|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_repos_keys</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
  <span class="nt">retries</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_install_retries</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">until</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result is succeeded</span>
  <span class="nt">delay</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_install_delay</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_repos_keys_manage</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;repos</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Manage repositories&quot;</span>
  <span class="nt">apt_repository</span><span class="p">:</span>
    <span class="nt">codename</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.codename|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">filename</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.filename|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.mode|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">repo</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.repo|mandatory</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">update_cache</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.update_cache|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">validate_certs</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.validate_certs|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_repos</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_repos_manage</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="resolvconf-yml">
<span id="as-resolvconf-yml"></span><h3><a class="toc-backref" href="#id96">resolvconf.yml</a></h3>
<p>Synopsis: Configure resolvconf.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/resolvconf.yml">resolvconf.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/resolvconf.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;resolvconf</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_resolvconf_service [{{ lp_resolvconf_service }}]</span>
      <span class="no">lp_resolvconf_enable [{{ lp_resolvconf_enable }}]</span>
      <span class="no">lp_package_state [{{ lp_package_state }}]</span>
      <span class="no">lp_resolvconf_packages</span>
      <span class="no">{{ lp_resolvconf_packages|to_nice_yaml }}</span>
      <span class="no">lp_resolvconf_confd_head_path [{{ lp_resolvconf_confd_head_path }}]</span>
      <span class="no">lp_resolvconf_conf_owner [{{ lp_resolvconf_conf_owner }}]</span>
      <span class="no">lp_resolvconf_conf_group [{{ lp_resolvconf_conf_group }}]</span>
      <span class="no">lp_resolvconf_conf_mode [{{ lp_resolvconf_conf_mode }}]</span>
      <span class="no">lp_resolvconf_confd_head</span>
      <span class="no">{{ lp_resolvconf_confd_head|to_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_resolvconf_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_resolvconf_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;resolvconf</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_resolvconf_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_resolvconf_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;resolvconf</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_resolvconf_confd_head_path }}&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">resolvconf-confd-head.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_resolvconf_confd_head_path</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_resolvconf_conf_owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_resolvconf_conf_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_resolvconf_conf_mode</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart resolvconf</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_resolvconf_confd_head</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;resolvconf</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Enable and start resolvconf&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_resolvconf_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_resolvconf_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_resolvconf_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;resolvconf</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Disable and stop resolvconf&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_resolvconf_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_resolvconf_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_resolvconf_service</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="service-yml">
<span id="as-service-yml"></span><h3><a class="toc-backref" href="#id97">service.yml</a></h3>
<p>Synopsis: Configure service.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/service.yml">service.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/service.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall service</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Set my_service_name_vars&quot;</span>
  <span class="nt">set_fact</span><span class="p">:</span>
    <span class="nt">my_service_name_vars</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">my_service_name_vars|default([])</span><span class="nv"> </span><span class="s">+</span>
                              <span class="s">[{item:</span><span class="nv"> </span><span class="s">lookup(&#39;vars&#39;,</span><span class="nv"> </span><span class="s">&#39;lp_&#39;</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">&#39;_service&#39;)}]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_service_enable</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lookup(&#39;vars&#39;, &#39;lp_&#39; + item, default=&#39;false&#39;)</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_service_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Set my_service_enable_vars&quot;</span>
  <span class="nt">set_fact</span><span class="p">:</span>
    <span class="nt">my_service_enable_vars</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">my_service_enable_vars|default([])</span><span class="nv"> </span><span class="s">+</span>
                                <span class="s">[{item:</span><span class="nv"> </span><span class="s">lookup(&#39;vars&#39;,</span><span class="nv"> </span><span class="s">&#39;lp_&#39;</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">&#39;_enable&#39;)}]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_service_enable</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lookup(&#39;vars&#39;, &#39;lp_&#39; + item, default=&#39;false&#39;)</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_service_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">my_msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">my_msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_service</span>
      <span class="no">{{ lp_service|to_nice_yaml }}</span>
      <span class="no">lp_service_enable</span>
      <span class="no">{{ lp_service_enable|to_nice_yaml }}</span>
      <span class="no">my_service_name_vars</span>
      <span class="no">{{ my_service_name_vars|default([])|to_nice_yaml }}</span>
      <span class="no">my_service_enable_vars</span>
      <span class="no">{{ my_service_enable_vars|default([])|to_nice_yaml }}</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_service_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_service_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Automaticaly enable or disable services managed by this role&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;vars&#39;,</span><span class="nv"> </span><span class="s">&#39;lp_&#39;</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">&#39;_service&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;vars&#39;,</span><span class="nv"> </span><span class="s">&#39;lp_&#39;</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">&#39;_enable&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_service_enable</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lookup(&#39;vars&#39;, &#39;lp_&#39; + item, default=&#39;false&#39;)</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_service_auto</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;service</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">General managent of services&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.enabled|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">arguments</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.arguments|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">pattern</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.pattern|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">runlevel</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.runlevel|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">sleep</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.sleep|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">use</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.use|default(&#39;omit&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">(item.state is defined) or</span>
        <span class="l l-Scalar l-Scalar-Plain">(item.enabled is defined)</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_service_general</span>

<span class="c1"># TODO: Mask a service. Do not allow any servce to activate a masked</span>
<span class="c1"># service. See tasks/wpagui.yml</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="smart-yml">
<span id="as-smart-yml"></span><h3><a class="toc-backref" href="#id98">smart.yml</a></h3>
<p>Synopsis: Configure smart.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/smart.yml">smart.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/smart.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall smart</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;smart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_smart_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_smart_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;smart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_smart_conf_file }}. Do not scan for devices&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_smart_conf_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^\\s*DEVICESCAN\\s*(.*)$&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_smart_conf_owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_smart_conf_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_smart_conf_mode</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_smart_devicescan|bool</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reload smart</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_smart_conf</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;smart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure devices in {{ lp_smart_conf_file }}&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_smart_conf_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.regexp</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.line</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_smart_conf_owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_smart_conf_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_smart_conf_mode</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_smart_devices</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reload smart</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_smart_conf</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;smart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Start and enable smart&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_smart_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_smart_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_smart_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;smart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug service&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_smart_debug|bool</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;smart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stop and disable smart&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_smart_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_smart_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_smart_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;smart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug service&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_smart_debug|bool</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="speechd-yml">
<span id="as-speechd-yml"></span><h3><a class="toc-backref" href="#id99">speechd.yml</a></h3>
<p>Synopsis: Configure speechd.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/speechd.yml">speechd.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/speechd.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall speechd</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;speechd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;lp_speechd_enable</span><span class="nv"> </span><span class="s">[{{</span><span class="nv"> </span><span class="s">lp_speechd_enable</span><span class="nv"> </span><span class="s">}}]&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_speechd_debug|bool</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;speechd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Enable and start speech-dispatcher&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_speechd_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_speechd_enable|bool</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;speechd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stop and disable speech-dispatcher&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_speechd_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_speechd_enable|bool</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="sshd-yml">
<span id="as-sshd-yml"></span><h3><a class="toc-backref" href="#id100">sshd.yml</a></h3>
<p>Synopsis: Configure sshd.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/sshd.yml">sshd.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/sshd.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall sshd</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;sshd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_sshd_config</span>
      <span class="no">{{ lp_sshd_config|to_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_sshd_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_sshd_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;sshd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/ssh/sshd_config&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/ssh/sshd_config</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^\\s*{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}\\s*(.*)$&quot;</span>
    <span class="nt">insertbefore</span><span class="p">:</span> <span class="s">&quot;^{{</span><span class="nv"> </span><span class="s">&#39;#&#39;</span><span class="nv"> </span><span class="s">}}{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}\\s*(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">validate</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_sshd_path</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">-t</span><span class="nv"> </span><span class="s">-f</span><span class="nv"> </span><span class="s">%s&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_sshd_config</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reload sshd</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_sshd_config</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;sshd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Enable and start sshd&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_sshd_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_sshd_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_sshd_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;sshd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Disable and stop sshd&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_sshd_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_sshd_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_sshd_service</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="ssh-yml">
<span id="as-ssh-yml"></span><h3><a class="toc-backref" href="#id101">ssh.yml</a></h3>
<p>Synopsis: Configure ssh.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/ssh.yml">ssh.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/ssh.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall ssh</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;ssh</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_ssh_config</span>
      <span class="no">{{ lp_ssh_config|to_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ssh_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ssh_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;ssh</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/ssh/ssh_config&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ssh_config.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/ssh/ssh_config</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ssh_conf</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="sudoers-yml">
<span id="as-sudoers-yml"></span><h3><a class="toc-backref" href="#id102">sudoers.yml</a></h3>
<p>Synopsis: Configure sudoers.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/sudoers.yml">sudoers.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/sudoers.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall sudoers</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;sudoers</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_sudoers_conf</span>
      <span class="no">{{ lp_sudoers_conf|to_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_sudoers_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_sudoers_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;sudoers</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/sudoers&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/sudoers</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.line</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state|default(&#39;present&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_sudoers_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_sudoers_conf</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;sudoers</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/sudoers.d/01&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/sudoers.d/01</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_sudoers_owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_sudoers_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_sudoers_mode</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_sudoers_01</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_sudoers_dconf</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="swap-yml">
<span id="as-swap-yml"></span><h3><a class="toc-backref" href="#id103">swap.yml</a></h3>
<p>Synopsis: Configure swap.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/swap.yml">swap.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/swap.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;swap</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_swap [{{ lp_swap }}]</span>
      <span class="no">lp_swap_enable [{{ lp_swap_enable }}]</span>
      <span class="no">lp_swap_file [{{ lp_swap_file|default(&quot;UNDEFINED&quot;) }}]</span>
      <span class="no">lp_swap_size [{{ lp_swap_size|default(&quot;UNDEFINED&quot;) }}]</span>
      <span class="no">lp_swap_stsize [{{ lp_swap_stsize|default(&quot;UNDEFINED&quot;) }}]</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_swap_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_swap_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;swap</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create swapfile {{ lp_swap_file }}&quot;</span>
  <span class="nt">shell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sh -c &#39;if [ ! -e {{ lp_swap_file }} ]; then printf &quot;create&quot;; fi&#39;</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">command_result</span>
  <span class="nt">changed_when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">command_result.stdout == &quot;create&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">create and mount swap file</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_swap_swapfile</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;swap</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Change swapfile {{ lp_swap_file }}&quot;</span>
  <span class="nt">shell</span><span class="p">:</span> <span class="p p-Indicator">&gt;</span>
    <span class="no">sh -c</span>
    <span class="no">&#39;if [ -e {{ lp_swap_file }} ] &amp;&amp;</span>
    <span class="no">[ &quot;`stat --format &#39;%s&#39; {{ lp_swap_file }}`&quot; -ne &quot;{{ lp_swap_stsize }}&quot; ];</span>
    <span class="no">then printf &quot;change&quot;;</span>
    <span class="no">fi&#39;</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">command_result</span>
  <span class="nt">changed_when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">command_result.stdout == &quot;change&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">change and mount swap file</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_swap_swapfile</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;swap</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create swap entry in /etc/fstab&quot;</span>
  <span class="nt">mount</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;none&quot;</span>
    <span class="nt">src</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_swap_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">fstype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">swap</span>
    <span class="nt">opts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sw</span>
    <span class="nt">passno</span><span class="p">:</span> <span class="s">&quot;0&quot;</span>
    <span class="nt">dump</span><span class="p">:</span> <span class="s">&quot;0&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_swap_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_swap_fstab</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;swap</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Remove swap entry from /etc/fstab&quot;</span>
  <span class="nt">mount</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;none&quot;</span>
    <span class="nt">src</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_swap_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">fstype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">swap</span>
    <span class="nt">opts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sw</span>
    <span class="nt">passno</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
    <span class="nt">dump</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">remove swap file</span>
  <span class="nt">when</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">not lp_swap_enable|bool</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lp_swap_file is defined</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_swap_swapfile</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="sysctl-yml">
<span id="as-sysctl-yml"></span><h3><a class="toc-backref" href="#id104">sysctl.yml</a></h3>
<p>Synopsis: Configure sysctl.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/sysctl.yml">sysctl.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/sysctl.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall sysctl</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;sysctl</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_sysctl_vars</span>
      <span class="no">{{ lp_sysctl_vars|to_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_sysctl_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_sysctl_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;sysctl</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/sysctl.conf&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/sysctl.conf</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^\\s*{{</span><span class="nv"> </span><span class="s">item.var</span><span class="nv"> </span><span class="s">}}\\s*=(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.var</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_sysctl_vars</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">load sysctl settings</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="timesyncd-yml">
<span id="as-timesyncd-yml"></span><h3><a class="toc-backref" href="#id105">timesyncd.yml</a></h3>
<p>Synopsis: Configure timesyncd.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/timesyncd.yml">timesyncd.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/timesyncd.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;timesyncd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_timesyncd [{{ lp_timesyncd }}]</span>
      <span class="no">lp_timesyncd_NTP [{{ lp_timesyncd_NTP }}]</span>
      <span class="no">lp_timesyncd_FallbackNTP [{{ lp_timesyncd_FallbackNTP }}]</span>
      <span class="no">lp_timesyncd_RootDistanceMaxSec [{{ lp_timesyncd_RootDistanceMaxSec }}]</span>
      <span class="no">lp_timesyncd_PollIntervalMinSec [{{ lp_timesyncd_PollIntervalMinSec }}]</span>
      <span class="no">lp_timesyncd_PollIntervalMaxSec [{{ lp_timesyncd_PollIntervalMaxSec }}]</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_timesyncd_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_timesyncd_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;timesyncd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/systemd/timesyncd.conf&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">timesyncd.conf.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/systemd/timesyncd.conf</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart timesyncd</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_timesyncd_conf</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;timesyncd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Enable and start timesyncd&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_timesyncd_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_timesyncd_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_timesyncd_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;timesyncd</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Disable and stop timesyncd&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_timesyncd_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_timesyncd_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_timesyncd_service</span>

<span class="c1"># Notes on CentOS</span>
<span class="c1"># * systemd compiled without timesyncd service in CentOS 7 ?</span>
<span class="c1"># * use ntpd or chrony only ?</span>
<span class="c1"># https://unix.stackexchange.com/questions/286708/</span>
<span class="c1"># centos-7-2-minimal-time-synchronization-timedated-and-or-ntpd-chrony</span>
<span class="c1"># https://www.freedesktop.org/wiki/Software/systemd/timedated/</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="timezone-yml">
<span id="as-timezone-yml"></span><h3><a class="toc-backref" href="#id106">timezone.yml</a></h3>
<p>Synopsis: Configure timezone.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/timezone.yml">timezone.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/timezone.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;timezone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;lp_timezone_zoneinfo</span><span class="nv"> </span><span class="s">[{{</span><span class="nv"> </span><span class="s">lp_timezone_zoneinfo</span><span class="nv"> </span><span class="s">}}]&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_timezone_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_timezone_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;timezone</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Set timezone {{ lp_timezone_zoneinfo }}&quot;</span>
  <span class="nt">timezone</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_timezone_zoneinfo|default(&#39;UTC&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_timezone_set</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="tlp-yml">
<span id="as-tlp-yml"></span><h3><a class="toc-backref" href="#id107">tlp.yml</a></h3>
<p>Synopsis: Configure tlp.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/tlp.yml">tlp.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/tlp.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall tlp</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;tlp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_tlp_enable [{{ lp_tlp_enable }}]</span>
      <span class="no">lp_tlp_thinkpad [{{ lp_tlp_thinkpad }}]</span>
      <span class="no">lp_tlp_packages</span>
      <span class="no">{{ lp_tlp_packages|to_nice_yaml }}</span>
      <span class="no">lp_tlp_packages_tp</span>
      <span class="no">{{ lp_tlp_packages_tp|to_nice_yaml }}</span>
      <span class="no">lp_tlp_config_file [{{ lp_tlp_config_file }}]</span>
      <span class="no">lp_tlp_config</span>
      <span class="no">{{ lp_tlp_config|to_nice_yaml }}</span>
      <span class="no">lp_tlp_services</span>
      <span class="no">{{ lp_tlp_services|to_nice_yaml }}</span>
      <span class="no">lp_tlp_restart_service [{{ lp_tlp_restart_service }}]</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_tlp_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_tlp_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;tlp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_tlp_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_tlp_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;tlp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages for ThinkPad&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_tlp_packages_tp</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_tlp_thinkpad|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_tlp_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;tlp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_tlp_config_file }}&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_tlp_config_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^\\s*{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}\\s*=\\s*(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}={{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_tlp_config</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">restart tlp</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_tlp_conf</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;tlp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Start and enable tlp&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_tlp_services</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_tlp_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_tlp_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;tlp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stop and disable tlp&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_tlp_services</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_tlp_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_tlp_service</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="udev-yml">
<span id="as-udev-yml"></span><h3><a class="toc-backref" href="#id108">udev.yml</a></h3>
<p>Synopsis: Configure udev.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/udev.yml">udev.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/udev.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall udev</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;udev</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_udev_rules_dir [{{ lp_udev_rules_dir }}]</span>
      <span class="no">lp_udev_rules_template [{{ lp_udev_rules_template }}]</span>
      <span class="no">lp_udev_rules</span>
      <span class="no">{{ lp_udev_rules|to_nice_yaml }}</span>

      <span class="no">lp_udev_persistent_net_template [{{ lp_udev_persistent_net_template }}]</span>
      <span class="no">lp_udev_persistent_net_rules_file [{{ lp_udev_persistent_net_rules_file }}]</span>
      <span class="no">lp_udev_persistent_net_rules</span>
      <span class="no">{{ lp_udev_persistent_net_rules|to_nice_yaml }}</span>

      <span class="no">lp_udev_hci_name_rules_file [{{ lp_udev_hci_name_rules_file }}]</span>
      <span class="no">lp_udev_hci_name_rules</span>
      <span class="no">{{ lp_udev_hci_name_rules|to_nice_yaml }}</span>

      <span class="no">lp_udev_hci_run_rules_file [{{ lp_udev_hci_run_rules_file }}]</span>
      <span class="no">lp_udev_hci_run_rules</span>
      <span class="no">{{ lp_udev_hci_run_rules|to_nice_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_udev_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_udev_debug</span>

<span class="c1"># udev rules</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;udev</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_udev_rules_dir }}&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_udev_rules_template</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_udev_rules_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_udev_rules|dict2items</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reload udev</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_udev_rules</span>

<span class="c1"># persistent_net</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;udev</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_udev_rules_dir }}/</span>
                         <span class="l l-Scalar l-Scalar-Plain">{{ lp_udev_persistent_net_rules_file }}&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_udev_persistent_net_template</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_udev_rules_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">lp_udev_persistent_net_rules_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_udev_persistent_net_rules</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reload udev</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_udev_persistentnet</span>

<span class="c1"># hci name</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;udev</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_udev_rules_dir }}/</span>
                         <span class="l l-Scalar l-Scalar-Plain">{{ lp_udev_hci_name_rules_file }}&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hci-name.rules.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_udev_rules_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">lp_udev_hci_name_rules_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_udev_hci_name_rules</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reload udev</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_udev_hciname</span>

<span class="c1"># hci run</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;udev</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_udev_rules_dir }}/</span>
                         <span class="l l-Scalar l-Scalar-Plain">{{ lp_udev_hci_run_rules_file }}&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hci-run.rules.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_udev_rules_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">lp_udev_hci_run_rules_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_udev_hci_run_rules</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reload udev</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_udev_hcirun</span>

<span class="c1"># Service</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;udev</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Start and enable udev&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_udev_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_udev_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_udev_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;udev</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stop and disable udev&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_udev_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_udev_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_udev_service</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="ufw-yml">
<span id="as-ufw-yml"></span><h3><a class="toc-backref" href="#id109">ufw.yml</a></h3>
<p>Synopsis: Configure ufw.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/ufw.yml">ufw.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/ufw.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall ufw</span>
</span>
<span class="c1">#   Notes</span>
<span class="c1">#</span>
<span class="c1"># * Aliases of parameters in ufw module not implemented in task</span>
<span class="c1">#   &quot;Configure ufw&quot;.</span>
<span class="c1"># * It&#39;s not necessary to reload ufs after configuration has</span>
<span class="c1">#   changed. Module ufw automatically updates the rules.</span>
<span class="c1"># * Best practice: First time &#39;lp_ufw_reset: true&#39;; configure and enable</span>
<span class="c1">#   ufs (configuration item {state: &#39;enabled&#39;} reloads firewall and</span>
<span class="c1">#   enables firewall on boot); &#39;lp_ufw_enable: true&#39; start and enable ufw</span>
<span class="c1">#   service.</span>
<span class="c1"># * Configuration on the fly: configure and enable ufs.</span>
<span class="c1"># * The last configuration item should be {state: &#39;enabled&#39;}.</span>
<span class="c1"># * See: man ufw.</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;ufw</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_ufw_enable [{{ lp_ufw_enable }}]</span>
      <span class="no">lp_ufw_reset [{{ lp_ufw_reset }}]</span>
      <span class="no">lp_ufw_reload [{{ lp_ufw_reload }}]</span>
      <span class="no">lp_ufw_packages</span>
      <span class="no">{{ lp_ufw_packages|to_nice_yaml }}</span>
      <span class="no">lp_ufw_conf</span>
      <span class="no">{{ lp_ufw_conf|to_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;ufw</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_ufw_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;ufw</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Disable and reset firewall to installation defaults&quot;</span>
  <span class="nt">ufw</span><span class="p">:</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reset</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_reset|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_reset</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;ufw</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Reload firewall&quot;</span>
  <span class="nt">ufw</span><span class="p">:</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reloaded</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_reload|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_reload</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;ufw</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure ufw&quot;</span>
  <span class="nt">ufw</span><span class="p">:</span>
    <span class="nt">comment</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.comment|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">default</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.default|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">delete</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.delete|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">direction</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.direction|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">from_ip</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.from_ip|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">from_port</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.from_port|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">insert</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.insert|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">insert_relative_to</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.insert_relative_to|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">interface</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.interface|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">log</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.log|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">logging</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.logging|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">proto</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.proto|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">route</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.route|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">rule</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.rule|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">to_ip</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.to_ip|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">to_port</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.to_port|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_ufw_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_conf</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;ufw</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Start and enable ufw&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_ufw_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;ufw</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug enabled service&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
  <span class="nt">when</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_enable|bool</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;ufw</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stop and disable ufw&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_ufw_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_ufw_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_service</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;ufw</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug disabled service&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
  <span class="nt">when</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">not lp_ufw_enable|bool</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_ufw_service</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="users-yml">
<span id="as-users-yml"></span><h3><a class="toc-backref" href="#id110">users.yml</a></h3>
<p>Synopsis: Configure users.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/users.yml">users.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/users.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;users</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_users</span>
      <span class="no">{{ lp_users|default([&#39;UNDEFINED&#39;])|to_nice_yaml }}</span>
      <span class="no">lp_users_groups</span>
      <span class="no">{{ lp_users_groups|default([&#39;UNDEFINED&#39;])|to_nice_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_users_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_users_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;users</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Manage user accounts&quot;</span>
  <span class="nt">user</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">authorization</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.authorization|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">comment</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.comment|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">create_home</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.create_home|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">expires</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.expires|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">force</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.force|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">generate_ssh_key</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.generate_ssh_key|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.group|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">hidden</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.hidden|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">home</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.home|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">local</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.local|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">login_class</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.login_class|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">move_home</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.move_home|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">non_unique</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.non_unique|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">password</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.password|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">password_lock</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.password_lock|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">profile</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.profile|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">remove</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.remove|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">role</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.role|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">seuser</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv">  </span><span class="s">item.seuser|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">shell</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.shell|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">skeleton</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.skeleton|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">ssh_key_bits</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.ssh_key_bits|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">ssh_key_comment</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.ssh_key_comment|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">ssh_key_file</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.ssh_key_file|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">ssh_key_passphrase</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.ssh_key_passphrase|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">ssh_key_type</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.ssh_key_type|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">system</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.system|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">uid</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.uid|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">update_password</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.update_password|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_users|default([])</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop_control</span><span class="p">:</span>
    <span class="nt">label</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_users_accounts</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;users</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Add users to additional groups&quot;</span>
  <span class="nt">user</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">groups</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.groups</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">append</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.append|default(true)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_users_groups|default([])</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_users_groups</span>

<span class="c1">#  EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="vars-yml">
<span id="as-vars-yml"></span><h3><a class="toc-backref" href="#id111">vars.yml</a></h3>
<p>Synopsis: Configure vars.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/vars.yml">vars.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/vars.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;vars</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Include default vars for</span>
              <span class="l l-Scalar l-Scalar-Plain">[{{ ansible_os_family }},</span>
               <span class="l l-Scalar l-Scalar-Plain">{{ ansible_distribution }},</span>
               <span class="l l-Scalar l-Scalar-Plain">{{ ansible_distribution_release }}]&quot;</span>
  <span class="nt">include_vars</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;first_found&#39;,</span><span class="nv"> </span><span class="s">params)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">params</span><span class="p">:</span>
      <span class="nt">files</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_distribution</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">ansible_distribution_release</span><span class="nv"> </span><span class="s">}}.yml&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_distribution</span><span class="nv"> </span><span class="s">}}.yml&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_os_family</span><span class="nv"> </span><span class="s">}}.yml&quot;</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">defaults.yml</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default.yml</span>
      <span class="nt">paths</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">role_path</span><span class="nv"> </span><span class="s">}}/vars/defaults&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;vars</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug include default vars from&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result.ansible_included_var_files</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_debug|bool</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;vars</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Include default vars for various flavors&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_flavors_enable|bool</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sub/vars-flavors.yml</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;vars</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Include custom vars for</span>
              <span class="l l-Scalar l-Scalar-Plain">[{{ ansible_os_family }},</span>
               <span class="l l-Scalar l-Scalar-Plain">{{ ansible_distribution }},</span>
               <span class="l l-Scalar l-Scalar-Plain">{{ ansible_distribution_release }}]&quot;</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
  <span class="nt">include_vars</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;first_found&#39;,</span><span class="nv"> </span><span class="s">params)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">params</span><span class="p">:</span>
      <span class="nt">files</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_distribution</span><span class="nv"> </span><span class="s">}}-{{</span><span class="nv"> </span><span class="s">ansible_distribution_release</span><span class="nv"> </span><span class="s">}}.yml&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_distribution</span><span class="nv"> </span><span class="s">}}.yml&quot;</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_os_family</span><span class="nv"> </span><span class="s">}}.yml&quot;</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">defaults.yml</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default.yml</span>
      <span class="nt">paths</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">role_path</span><span class="nv"> </span><span class="s">}}/vars&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;vars</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug include custom vars from&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result.ansible_included_var_files</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_debug|bool</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="virtualbox-yml">
<span id="as-virtualbox-yml"></span><h3><a class="toc-backref" href="#id112">virtualbox.yml</a></h3>
<p>Synopsis: Configure virtualbox.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/virtualbox.yml">virtualbox.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/virtualbox.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall virtualbox</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;virtualbox</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">ansible_lsb.description [{{ ansible_lsb.codename }}]</span>
      <span class="no">lp_virtualbox [{{ lp_virtualbox }}]</span>
      <span class="no">lp_virtualbox_ignore_errors [{{ lp_virtualbox_ignore_errors }}]</span>
      <span class="no">lp_virtualbox_keys [{{ lp_virtualbox_keys }}]</span>
      <span class="no">lp_virtualbox_repos [{{ lp_virtualbox_repos }}]</span>
      <span class="no">lp_virtualbox_install</span>
      <span class="no">{{ lp_virtualbox_install|to_nice_yaml }}</span>
      <span class="no">lp_virtualbox_services</span>
      <span class="no">{{ lp_virtualbox_services|to_nice_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_virtualbox_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_virtualbox_debug</span>

<span class="c1"># TODO: assert lp_virtualbox_modules are loaded</span>
<span class="c1">#       when: lp_virtualbox|bool</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;virtualbox</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Add signing key of VirtualBox&quot;</span>
  <span class="nt">apt_key</span><span class="p">:</span>
    <span class="nt">url</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_virtualbox_keys</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result</span>
  <span class="nt">retries</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_install_retries</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">until</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">result is succeeded</span>
  <span class="nt">delay</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_install_delay</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">ignore_errors</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_virtualbox_ignore_errors</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_virtualbox_keys</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;virtualbox</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Add repository of VirtualBox&quot;</span>
  <span class="nt">apt_repository</span><span class="p">:</span>
    <span class="nt">repo</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">present</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_virtualbox_repos</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">ignore_errors</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_virtualbox_ignore_errors</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_virtualbox_repos</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;virtualbox</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install VirtualBox packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_virtualbox_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">ignore_errors</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_virtualbox_ignore_errors</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_virtualbox_pkg</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;virtualbox</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Enable and start services&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">started</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_virtualbox_services</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_virtualbox_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_virtualbox_services</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;virtualbox</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Disable and stop services&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_virtualbox_services</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">not lp_virtualbox_enable|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_virtualbox_services</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="wpagui-yml">
<span id="as-wpagui-yml"></span><h3><a class="toc-backref" href="#id113">wpagui.yml</a></h3>
<p>Synopsis: Configure wpagui.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/wpagui.yml">wpagui.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/wpagui.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall wpa_gui</span>
</span><span class="c1"># Install wpa_gui and disable NetworkManager</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;wpagui</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_wpagui_packages</span>
      <span class="no">{{ lp_wpagui_packages|to_nice_yaml }}</span>
      <span class="no">lp_wpagui_systemd</span>
      <span class="no">{{ lp_wpagui_systemd|to_nice_yaml }}</span>
      <span class="no">lp_wpagui_service</span>
      <span class="no">{{ lp_wpagui_service|to_nice_yaml }}</span>
      <span class="no">lp_wpagui_service_mask</span>
      <span class="no">{{ lp_wpagui_service_mask|to_nice_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpagui_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpagui_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;wpagui</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpagui_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpagui_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;wpagui</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Disable NM /etc/init/network-manager.override&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">network-manager-override.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/init/network-manager.override</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">group</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;0644&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpagui_disableNM</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;wpagui</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure managed=false</span>
                 <span class="l l-Scalar l-Scalar-Plain">in /etc/NetworkManager/NetworkManager.conf&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/NetworkManager/NetworkManager.conf</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^\\s*managed\\s*=\\s*(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;managed=false&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpagui_disableNM</span>

<span class="c1"># NetworkManager.service will be stopped and disabled in the next task</span>
<span class="c1"># - name: &quot;wpagui: Stop and disable NM&quot;</span>
<span class="c1">#  systemd:</span>
<span class="c1">#    name: &quot;{{ item }}&quot;</span>
<span class="c1">#    state: stopped</span>
<span class="c1">#    enabled: false</span>
<span class="c1">#  loop: &quot;{{ lp_wpagui_systemd }}&quot;</span>
<span class="c1">#  tags: lp_wpagui_disableNM</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;wpagui</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Stop and disable all NM services&quot;</span>
  <span class="nt">service</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">stopped</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpagui_service</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpagui_disableNM</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;wpagui</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Mask NM services&quot;</span>
  <span class="nt">command</span><span class="p">:</span> <span class="s">&quot;systemctl</span><span class="nv"> </span><span class="s">mask</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="nt">warn</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpagui_service_mask</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">changed_when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpagui_mask_NM</span>
  <span class="c1">#</span>
  <span class="c1"># False Positives: Skipping Rules</span>
  <span class="c1"># https://github.com/ansible/ansible-lint#false-positives-skipping-rules</span>
  <span class="c1"># noqa 303 does not work</span>
  <span class="c1">#</span>
  <span class="c1"># ansible-lint &quot;systemctl used in place of systemd module&quot; No</span>
  <span class="c1"># systemctl / systemd module. #48848</span>
  <span class="c1"># https://github.com/ansible/ansible/issues/48848</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="wpasupplicant-yml">
<span id="as-wpasupplicant-yml"></span><h3><a class="toc-backref" href="#id114">wpasupplicant.yml</a></h3>
<p>Synopsis: Configure wpasupplicant.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/wpasupplicant.yml">wpasupplicant.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/wpasupplicant.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;wpasupplicant</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_package_state [{{ lp_package_state }}]</span>
      <span class="no">lp_wpasupplicant_packages</span>
      <span class="no">{{ lp_wpasupplicant_packages|to_nice_yaml }}</span>
      <span class="no">lp_wpasupplicant_conf_only [{{ lp_wpasupplicant_conf_only }}]</span>
      <span class="no">lp_wpasupplicant_conf_dir [{{ lp_wpasupplicant_conf_dir }}]</span>
      <span class="no">lp_wpasupplicant_conf_file [{{ lp_wpasupplicant_conf_file }}]</span>
      <span class="no">lp_wpasupplicant_conf_owner [{{ lp_wpasupplicant_conf_owner }}]</span>
      <span class="no">lp_wpasupplicant_conf_group [{{ lp_wpasupplicant_conf_group }}]</span>
      <span class="no">lp_wpasupplicant_conf_mode [{{ lp_wpasupplicant_conf_mode }}]</span>
      <span class="no">lp_wpasupplicant_conf_ctrl_interface</span>
      <span class="no">[{{ lp_wpasupplicant_conf_ctrl_interface }}]</span>
      <span class="no">lp_wpasupplicant_conf_global</span>
      <span class="no">{{ lp_wpasupplicant_conf_global|to_yaml }}</span>
      <span class="no">lp_wpa_action_script [{{ lp_wpa_action_script }}]</span>
      <span class="no">lp_wpa_action_script_dir [{{ lp_wpa_action_script_dir }}]</span>
      <span class="no">lp_wpa_action_script_file [{{ lp_wpa_action_script_file }}]</span>
      <span class="no">lp_wpa_action_script_owner [{{ lp_wpa_action_script_owner }}]</span>
      <span class="no">lp_wpa_action_script_group [{{ lp_wpa_action_script_group }}]</span>
      <span class="no">lp_wpa_action_script_mode [{{ lp_wpa_action_script_mode }}]</span>
      <span class="no">lp_wpa_action_script_dhclient [{{ lp_wpa_action_script_dhclient }}]</span>
      <span class="no">lp_wpa_action_script_pidfile [{{ lp_wpa_action_script_pidfile }}]</span>
      <span class="no">lp_wpa_action_script_options_connect [{{ lp_wpa_action_script_options_connect }}]</span>
      <span class="no">lp_wpa_action_script_options_disconnect [{{ lp_wpa_action_script_options_disconnect }}]</span>
      <span class="no">lp_wpa_action_script_logfile [{{ lp_wpa_action_script_logfile }}]</span>

      <span class="no">{% if lp_wpasupplicant_debug_classified|bool %}</span>
      <span class="no">lp_wpasupplicant_conf</span>
      <span class="no">{{ lp_wpasupplicant_conf|to_yaml }}</span>
      <span class="no">{% endif %}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpasupplicant_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpasupplicant_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;wpasupplicant</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpasupplicant_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpasupplicant_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;wpasupplicant</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_wpasupplicant_conf_dir }}/{{</span>
                                     <span class="l l-Scalar l-Scalar-Plain">lp_wpasupplicant_conf_file }}.DEV&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wpa_supplicant.conf.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpasupplicant_conf_dir</span><span class="nv"> </span><span class="s">}}/{{</span>
              <span class="s">lp_wpasupplicant_conf_file</span><span class="nv"> </span><span class="s">}}.{{</span>
              <span class="s">item.dev</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpasupplicant_conf_owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpasupplicant_conf_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpasupplicant_conf_mode</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpasupplicant_conf_changes</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">reconfigure wpa_supplicant</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpasupplicant_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">no_log</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">lp_wpasupplicant_debug_classified</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpasupplicant_conf</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;wpasupplicant</span><span class="p">:</span> <span class="nt">Debug</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">registered lp_wpasupplicant_conf_changes&quot;</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">var</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpasupplicant_conf_changes</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpasupplicant_debug_classified|bool</span>

<span class="c1"># - name: &quot;wpasupplicant: Debug: wpa_cli reconfigure commands&quot;</span>
<span class="c1">#  debug:</span>
<span class="c1">#    msg: &gt;</span>
<span class="c1">#      &#39;sh -c &quot;[ -S {{ lp_wpasupplicant_conf_ctrl_interface }}/\</span>
<span class="c1">#                   {{ item.item.dev }} ] &amp;&amp;</span>
<span class="c1">#      wpa_cli -p {{ lp_wpasupplicant_conf_ctrl_interface }} \</span>
<span class="c1">#              -i {{ item.item.dev }} reconfigure&quot;&#39;</span>
<span class="c1">#  loop: &quot;{{ lp_wpasupplicant_conf_changes.results }}&quot;</span>
<span class="c1">#  when:</span>
<span class="c1">#    - item.changed</span>
<span class="c1">#    - lp_wpasupplicant_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;wpasupplicant</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create dir {{ lp_wpa_action_script_dir }}&quot;</span>
  <span class="nt">file</span><span class="p">:</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">directory</span>
    <span class="nt">path</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpa_action_script_dir</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpa_action_script_owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpa_action_script_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpa_action_script|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpa_action_script_dir</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;wpasupplicant</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Create script {{ lp_wpa_action_script_file }}&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">wpa_action.sh.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpa_action_script_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpa_action_script_owner</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpa_action_script_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_wpa_action_script_mode</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpa_action_script|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_wpa_action_script_file</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="xen-yml">
<span id="as-xen-yml"></span><h3><a class="toc-backref" href="#id115">xen.yml</a></h3>
<p>Synopsis: Configure xen.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/xen.yml">xen.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/xen.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall xen</span>
</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;xen</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_xen_packages</span>
      <span class="no">{{ lp_xen_packages|to_nice_yaml }}</span>
      <span class="no">lp_xen_dom0_mem</span>
      <span class="no">{{ lp_xen_dom0_mem|to_nice_yaml }}</span>
      <span class="no">lp_xen_default_grub_conf</span>
      <span class="no">{{ lp_xen_default_grub_conf|to_nice_yaml }}</span>
      <span class="no">lp_xen_global</span>
      <span class="no">{{ lp_xen_global|to_nice_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_xen_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_xen_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;xen</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_xen_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_xen_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;xen</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/default/grub&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/default/grub</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^\\s*{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}\\s*=\\s*(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.key</span><span class="nv"> </span><span class="s">}}={{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_xen_default_grub_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">notify</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">update grub</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_xen_default_grub</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;xen</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure /etc/xen/xl.conf&quot;</span>
  <span class="nt">lineinfile</span><span class="p">:</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc/xen/xl.conf</span>
    <span class="nt">regexp</span><span class="p">:</span> <span class="s">&quot;^\\s*{{</span><span class="nv"> </span><span class="s">item.var</span><span class="nv"> </span><span class="s">}}\\s*=\\s*(.*)$&quot;</span>
    <span class="nt">line</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.var</span><span class="nv"> </span><span class="s">}}={{</span><span class="nv"> </span><span class="s">item.value</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">create</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_xen_global</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_xen_global</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="xorg-yml">
<span id="as-xorg-yml"></span><h3><a class="toc-backref" href="#id116">xorg.yml</a></h3>
<p>Synopsis: Configure xorg.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/xorg.yml">xorg.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/xorg.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;xorg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_xorg_conf</span>
      <span class="no">{{ lp_xorg_conf|to_nice_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_xorg_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_xorg_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;xorg</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Configure {{ lp_xorg_conf_dir }}&quot;</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">xorg.conf.j2</span>
    <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_xorg_conf_dir</span><span class="nv"> </span><span class="s">}}/{{</span><span class="nv"> </span><span class="s">item.file</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">backup</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_backup_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_xorg_conf</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_xorg_conf</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="zeitgeist-yml">
<span id="as-zeitgeist-yml"></span><h3><a class="toc-backref" href="#id117">zeitgeist.yml</a></h3>
<p>Synopsis: Configure zeitgeist.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/zeitgeist.yml">zeitgeist.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/zeitgeist.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll"><span class="c1"># linux-postinstall zeitgeist</span>
</span>
<span class="c1"># One-way atm</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Remove zeitgeist</span>
  <span class="nt">apt</span><span class="p">:</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zeitgeist</span>
    <span class="nt">purge</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">when</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">not lp_zeitgeist|bool</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Remove zeitgeist-*</span>
  <span class="nt">apt</span><span class="p">:</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zeitgeist-*</span>
    <span class="nt">purge</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">when</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">not lp_zeitgeist|bool</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>

<span class="c1"># - name: Disable zeitgeist</span>
<span class="c1">#   service:</span>
<span class="c1">#     name: zeitgeist</span>
<span class="c1">#     state: stopped</span>
<span class="c1">#     enabled: no</span>
<span class="c1">#   when: not lp_zeitgeist</span>
<span class="c1"># &quot;Could not find the requested service zeitgeist&quot;</span>

<span class="c1"># for i in zeitgeist-fts zeitgeist; do</span>
<span class="c1"># systemctl --user disable $i;</span>
<span class="c1"># systemctl --user stop $i;</span>
<span class="c1"># systemctl --user mask $i;</span>
<span class="c1"># done</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="zfs-yml">
<span id="as-zfs-yml"></span><h3><a class="toc-backref" href="#id118">zfs.yml</a></h3>
<p>Synopsis: Configure zfs.</p>
<p>Description of the task.</p>
<p>[<a class="reference external" href="https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/zfs.yml">zfs.yml</a><span class="link-target"> [https://github.com/vbotka/ansible-linux-postinstall/blob/master/tasks/zfs.yml]</span>]</p>
<div class="highlight-Yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="hll"><span class="nn">---</span>
</span><span class="hll">
</span><span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;zfs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Debug&quot;</span>
  <span class="nt">vars</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">lp_zfs_install [{{ lp_zfs_install }}]</span>
      <span class="no">lp_zfs_packages</span>
      <span class="no">{{ lp_zfs_packages|to_nice_yaml }}</span>
      <span class="no">lp_zfs_services</span>
      <span class="no">{{ lp_zfs_services|default([])|to_yaml }}</span>
      <span class="no">lp_zfs_manage</span>
      <span class="no">{{ lp_zfs_manage|to_yaml }}</span>
      <span class="no">lp_zfs_mountpoints</span>
      <span class="no">{{ lp_zfs_mountpoints|to_yaml }}</span>
  <span class="nt">debug</span><span class="p">:</span>
    <span class="nt">msg</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">msg.split(&#39;\n&#39;)[:-1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_zfs_debug|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_zfs_debug</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;zfs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Install packages&quot;</span>
  <span class="nt">include_tasks</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fn/install-package.yml</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_zfs_packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">when</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_zfs_install|bool</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_zfs_packages</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;zfs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Manage zfs services&quot;</span>
  <span class="nt">systemd</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">enabled</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.enabled|default(true)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state|default(&#39;started&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_zfs_services|default([])</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_zfs_services</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;zfs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Manage zfs&quot;</span>
  <span class="nt">zfs</span><span class="p">:</span>
    <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.name</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">state</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.state</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">origin</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.origin|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">extra_zfs_properties</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.extra_zfs_properties|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_zfs_manage</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_zfs_manage</span>

<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="nt">&quot;zfs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Set mode and ownership of zfs mountpoints&quot;</span>
  <span class="nt">file</span><span class="p">:</span>
    <span class="nt">state</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">directory</span>
    <span class="nt">path</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.mountpoint</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">owner</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.owner|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">group</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.group|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.mode|default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">loop</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lp_zfs_mountpoints</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">tags</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lp_zfs_mountpoints</span>

<span class="c1"># EOF</span>
<span class="nn">...</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>